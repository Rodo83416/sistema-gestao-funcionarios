<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Funcionários por Posto de Trabalho</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#4F46E5',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        light: '#F9FAFB',
                        dark: '#1e2130',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-light dark:bg-dark text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <!-- Detectar modo escuro -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Tela de login -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-light dark:bg-dark p-4">
        <div class="w-full max-w-md bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <div class="p-6 sm:p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-primary dark:text-gray-100">
                        <i class="fas fa-users-cog mr-2"></i>Sistema de Gestão
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Faça login para acessar o sistema</p>
                </div>
                
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Usuário</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                <i class="fas fa-user"></i>
                            </span>
                            <input type="text" id="login-username" name="username" required class="w-full py-2 pl-10 pr-3 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:ring-primary focus:border-primary" placeholder="Digite admin">
                        </div>
                    </div>
                    
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Senha</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                <i class="fas fa-lock"></i>
                            </span>
                            <input type="password" id="login-password" name="password" required class="w-full py-2 pl-10 pr-3 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:ring-primary focus:border-primary" placeholder="Digite admin123">
                        </div>
                    </div>
                    
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-150">
                            <span>Entrar</span>
                            <i class="fas fa-sign-in-alt ml-2"></i>
                        </button>
                    </div>
                </form>
                
                <div class="mt-6">
                    <div class="text-center text-sm text-gray-600 dark:text-gray-400">
                        <p>Credenciais: <span class="font-bold">admin</span> / <span class="font-bold">admin123</span></p>
                    </div>
                </div>
            </div>
            
            <div class="px-6 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
                <p class="text-center text-sm text-gray-600 dark:text-gray-400">
                    Sistema de Gestão de Funcionários por Posto de Trabalho - v1.0
                </p>
            </div>
        </div>
    </div>
    
    <!-- Container principal da aplicação -->
    <div id="app-container" class="min-h-screen flex flex-col hidden">
        <!-- Header -->
        <header id="app-header" class="bg-white dark:bg-gray-900 shadow-md py-4 px-6">
            <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-2xl font-bold text-primary dark:text-gray-100 mb-3 sm:mb-0">
                    <i class="fas fa-users-cog mr-2"></i>Gestão de Funcionários
                </h1>
                <div class="flex flex-wrap justify-center gap-2">
                    <button id="btn-dashboard" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-tachometer-alt mr-1"></i>Dashboard
                    </button>
                    <button id="btn-employee-list" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-users mr-1"></i>Funcionários
                    </button>
                    <button id="btn-allocation-history" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-exchange-alt mr-1"></i>Transferências
                    </button>
                    <button id="btn-supervisor-management" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-user-tie mr-1"></i>Supervisores
                    </button>
                    <button id="btn-workstation-management" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-building mr-1"></i>Postos
                    </button>
                    <button id="btn-import-export" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-file-import mr-1"></i>Importar/Exportar
                    </button>
                </div>
                <!-- Informações do usuário logado -->
                <div id="user-info" class="mt-3 sm:mt-0 sm:ml-4 flex items-center gap-3">
                    <div class="text-right hidden sm:block">
                        <p class="font-medium text-sm" id="current-user-name">admin</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400" id="current-user-role">Administrador</p>
                    </div>
                    <div class="dropdown relative">
                        <button class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 p-2 rounded-full">
                            <i class="fas fa-user-circle text-lg"></i>
                        </button>
                        <div class="dropdown-menu hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10">
                            <div class="py-1">
                                <p class="px-4 py-2 text-sm sm:hidden">
                                    <span id="mobile-user-name" class="font-medium">admin</span><br>
                                    <span id="mobile-user-role" class="text-xs text-gray-500 dark:text-gray-400">Administrador</span>
                                </p>
                                <a href="#" id="btn-my-profile" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-id-card mr-2"></i>Meu Perfil
                                </a>
                                <a href="#" id="btn-logout" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Sair
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Conteúdo principal -->
        <main class="flex-grow container mx-auto px-4 py-6">
            <!-- Área de notificação -->
            <div id="notification-area" class="hidden mb-4 p-4 rounded"></div>

            <!-- Seção Dashboard -->
            <section id="dashboard-section" class="section-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Dashboard</h2>
                    <div class="flex flex-wrap gap-2">
                        <button id="btn-new-supervisor" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-user-tie mr-1"></i>Novo Supervisor
                        </button>
                        <button id="btn-new-workstation" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-building mr-1"></i>Novo Posto
                        </button>
                        <button id="btn-new-employee" class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-user-plus mr-1"></i>Novo Funcionário
                        </button>
                        <button id="btn-transfer-employee" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-exchange-alt mr-1"></i>Transferir
                        </button>
                    </div>
                </div>

                <!-- Cartões de resumo -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5">
                        <h3 class="font-medium text-gray-500 dark:text-gray-400 mb-2">Total de Supervisores</h3>
                        <p id="total-supervisors" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5">
                        <h3 class="font-medium text-gray-500 dark:text-gray-400 mb-2">Postos de Trabalho</h3>
                        <p id="total-workstations" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5">
                        <h3 class="font-medium text-gray-500 dark:text-gray-400 mb-2">Funcionários</h3>
                        <p id="total-employees" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5">
                        <h3 class="font-medium text-gray-500 dark:text-gray-400 mb-2">Taxa de Ocupação</h3>
                        <p id="occupancy-rate" class="text-3xl font-bold">0%</p>
                    </div>
                </div>

                <!-- Status de ocupação dos postos -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 mb-6">
                    <h3 class="font-medium text-lg mb-4">Status de Ocupação dos Postos</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Posto</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Supervisor</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ocupação</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody id="occupancy-summary" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados serão inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Resumo por Supervisores -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 mb-6">
                    <h3 class="font-medium text-lg mb-4">Supervisores e Postos de Trabalho</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ID</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Supervisor</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Postos de Trabalho</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Funcionários</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="supervisors-summary" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados serão inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Seção de Funcionários -->
            <section id="employee-list-section" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Funcionários</h2>
                    <div class="flex flex-wrap gap-2">
                        <button id="btn-new-employee-2" class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-user-plus mr-1"></i>Novo Funcionário
                        </button>
                        <button id="btn-transfer-employee-2" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-4 rounded transition-colors">
                            <i class="fas fa-exchange-alt mr-1"></i>Transferir
                        </button>
                    </div>
                </div>
                
                <!-- Filtros e pesquisa -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="employee-search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pesquisar</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="employee-search" placeholder="Nome ou matrícula" class="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="employee-status-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                            <select id="employee-status-filter" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Todos</option>
                                <option value="Ativo">Ativo</option>
                                <option value="Férias">Férias</option>
                                <option value="Afastado">Afastado</option>
                                <option value="Inativo">Inativo</option>
                            </select>
                        </div>
                        <div>
                            <label for="employee-workstation-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Posto de Trabalho</label>
                            <select id="employee-workstation-filter" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Todos</option>
                                <!-- Opções serão populadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de funcionários -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Matrícula</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nome</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cargo</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Admissão</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Posto Atual</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="employee-list" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Será preenchido dinamicamente -->
                                <tr>
                                    <td colspan="6" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                        <p class="mb-2">Nenhum funcionário cadastrado</p>
                                        <button id="add-first-employee" class="px-4 py-2 bg-success hover:bg-green-600 text-white rounded-md">
                                            <i class="fas fa-user-plus mr-1"></i>Adicionar Funcionário
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Seção de Transferências -->
            <section id="allocation-history-section" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Transferências</h2>
                    <button id="btn-new-transfer" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-exchange-alt mr-1"></i>Nova Transferência
                    </button>
                </div>
                
                <!-- Filtros -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="transfer-search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pesquisar Funcionário</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="transfer-search" placeholder="Nome ou matrícula" class="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="transfer-workstation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Posto de Trabalho</label>
                            <select id="transfer-workstation" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Todos os postos</option>
                                <!-- Opções serão populadas dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label for="transfer-date-start" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data Inicial</label>
                            <input type="date" id="transfer-date-start" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                        <div>
                            <label for="transfer-date-end" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data Final</label>
                            <input type="date" id="transfer-date-end" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                    </div>
                </div>
                
                <!-- Histórico de transferências -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Funcionário</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Origem</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Destino</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Observações</th>
                                </tr>
                            </thead>
                            <tbody id="transfer-history" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Será preenchido dinamicamente -->
                                <tr>
                                    <td colspan="5" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                        <p class="mb-2">Nenhuma transferência registrada</p>
                                        <button id="add-first-allocation" class="px-4 py-2 bg-warning hover:bg-amber-600 text-white rounded-md">
                                            <i class="fas fa-exchange-alt mr-1"></i>Registrar Transferência
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Relatório mensal de transferências -->
                <div class="mt-8">
                    <h3 class="text-lg font-medium mb-4">Relatório Mensal de Alocações</h3>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="monthly-report-month" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mês/Ano</label>
                                <input type="month" id="monthly-report-month" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label for="monthly-report-workstation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Posto de Trabalho</label>
                                <select id="monthly-report-workstation" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option value="">Todos os postos</option>
                                    <!-- Opções serão populadas dinamicamente -->
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="btn-generate-monthly-report" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                                    <i class="fas fa-chart-bar mr-1"></i>Gerar Relatório
                                </button>
                                <button id="btn-export-monthly-report" class="ml-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium py-2 px-4 rounded transition-colors">
                                    <i class="fas fa-file-export mr-1"></i>Exportar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="monthly-report-container" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 hidden">
                        <h4 id="monthly-report-title" class="text-lg font-medium mb-4">Relatório de Alocações - Mês/Ano</h4>
                        <div id="monthly-report-content" class="space-y-4">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Supervisores -->
            <section id="supervisor-management-section" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Gerenciamento de Supervisores</h2>
                    <button id="btn-new-supervisor-2" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-user-tie mr-1"></i>Novo Supervisor
                    </button>
                </div>
                
                <!-- Filtros e pesquisa -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="supervisor-search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pesquisar</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="supervisor-search" placeholder="Nome ou matrícula" class="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="supervisor-workstation-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Filtrar por Posto de Trabalho</label>
                            <select id="supervisor-workstation-filter" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Todos os postos</option>
                                <!-- Opções serão populadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de supervisores -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- As cards serão preenchidas dinamicamente -->
                    <div id="supervisors-grid">
                        <!-- Dados serão inseridos via JavaScript -->
                    </div>
                </div>
                
                <!-- Detalhes do supervisor selecionado -->
                <div id="supervisor-details" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6 hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 id="detail-supervisor-name" class="text-xl font-bold">Nome do Supervisor</h3>
                            <p id="detail-supervisor-code" class="text-gray-600 dark:text-gray-400">Matrícula: SUP-001</p>
                        </div>
                        <div class="flex gap-2">
                            <button id="btn-edit-detail-supervisor" class="bg-primary hover:bg-secondary text-white px-3 py-1 rounded">
                                <i class="fas fa-edit mr-1"></i>Editar
                            </button>
                            <button id="btn-delete-detail-supervisor" class="bg-danger hover:bg-red-600 text-white px-3 py-1 rounded">
                                <i class="fas fa-trash-alt mr-1"></i>Excluir
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <h4 class="text-sm text-gray-500 dark:text-gray-400 uppercase mb-1">Postos Supervisionados</h4>
                            <p id="detail-supervisor-workstations-count" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <h4 class="text-sm text-gray-500 dark:text-gray-400 uppercase mb-1">Funcionários</h4>
                            <p id="detail-supervisor-employees-count" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <h4 class="text-sm text-gray-500 dark:text-gray-400 uppercase mb-1">Taxa de Ocupação</h4>
                            <p id="detail-supervisor-occupancy" class="text-2xl font-bold">0%</p>
                        </div>
                    </div>
                    
                    <!-- Postos de trabalho sob responsabilidade -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3">Postos de Trabalho</h4>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                                <thead class="bg-gray-100 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nome</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Capacidade</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ocupação</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="detail-supervisor-workstations" class="divide-y divide-gray-200 dark:divide-gray-600">
                                    <!-- As linhas serão preenchidas dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Funcionários sob supervisão -->
                    <div>
                        <h4 class="font-medium mb-3">Funcionários</h4>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                                <thead class="bg-gray-100 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nome</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cargo</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Posto</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="detail-supervisor-employees" class="divide-y divide-gray-200 dark:divide-gray-600">
                                    <!-- As linhas serão preenchidas dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gráfico de ocupação por supervisor -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium mb-4">Ocupação por Supervisor</h3>
                    <div class="h-64 md:h-80" id="supervisor-occupancy-chart">
                        <!-- Aqui seria inserido um gráfico com uma biblioteca como Chart.js -->
                        <!-- Como alternativa, usamos uma visualização baseada em HTML -->
                        <div class="h-full flex items-end justify-around gap-2 pt-6 pb-2">
                            <!-- Barras serão preenchidas dinamicamente -->
                            <div id="supervisor-chart-bars" class="w-full h-full flex items-end justify-around">
                                <!-- As barras serão preenchidas dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Postos de Trabalho -->
            <section id="workstation-management-section" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Postos de Trabalho</h2>
                    <button id="btn-new-workstation-2" class="bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors">
                        <i class="fas fa-plus-circle mr-1"></i>Novo Posto
                    </button>
                </div>
                
                <!-- Filtros e pesquisa -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="workstation-search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pesquisar</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="workstation-search" placeholder="Nome do posto" class="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="workstation-supervisor-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Supervisor</label>
                            <select id="workstation-supervisor-filter" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Todos os supervisores</option>
                                <!-- Opções serão populadas dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label for="workstation-capacity-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Capacidade</label>
                            <select id="workstation-capacity-filter" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">Qualquer capacidade</option>
                                <option value="low">Baixa (1-5)</option>
                                <option value="medium">Média (6-15)</option>
                                <option value="high">Alta (16+)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de postos em formato de cards grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="workstations-grid">
                    <!-- Cards serão gerados dinamicamente -->
                </div>
                
                <!-- Visão de lista alternativa (tabela) -->
                <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex flex-wrap justify-between items-center">
                        <h3 class="text-lg font-medium">Lista de Postos</h3>
                        <div class="flex mt-2 sm:mt-0">
                            <button id="btn-grid-view" class="px-3 py-1 bg-primary text-white rounded-l flex items-center">
                                <i class="fas fa-th-large mr-1"></i>Cards
                            </button>
                            <button id="btn-list-view" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-r flex items-center">
                                <i class="fas fa-list-ul mr-1"></i>Lista
                            </button>
                        </div>
                    </div>
                    <div id="workstations-list-container" class="hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nome</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Supervisor</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Capacidade</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ocupação</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="workstations-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Linhas serão geradas dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Importação/Exportação -->
            <section id="import-export-section" class="section-content hidden">
                <h2 class="text-xl font-semibold mb-6">Importar/Exportar</h2>
                
                <!-- Exportar Dados -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-medium mb-4">Exportar Dados</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Exporte os dados do sistema em arquivos CSV que podem ser abertos no Excel.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Supervisores</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Exporta informações de todos os supervisores cadastrados no sistema.</p>
                            <button id="btn-export-supervisors" class="w-full py-2 px-4 bg-primary hover:bg-secondary text-white rounded flex items-center justify-center">
                                <i class="fas fa-file-export mr-2"></i>Exportar Supervisores
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Postos de Trabalho</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Exporta informações de todos os postos de trabalho cadastrados.</p>
                            <button id="btn-export-workstations" class="w-full py-2 px-4 bg-primary hover:bg-secondary text-white rounded flex items-center justify-center">
                                <i class="fas fa-file-export mr-2"></i>Exportar Postos
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Funcionários</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Exporta informações de todos os funcionários cadastrados no sistema.</p>
                            <button id="btn-export-employees" class="w-full py-2 px-4 bg-primary hover:bg-secondary text-white rounded flex items-center justify-center">
                                <i class="fas fa-file-export mr-2"></i>Exportar Funcionários
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Histórico de Transferências</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Exporta o histórico completo de transferências entre postos.</p>
                            <button id="btn-export-allocations" class="w-full py-2 px-4 bg-primary hover:bg-secondary text-white rounded flex items-center justify-center">
                                <i class="fas fa-file-export mr-2"></i>Exportar Transferências
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg md:col-span-2">
                            <h4 class="font-medium mb-2">Backup Completo</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Exporta todos os dados do sistema em um único arquivo JSON.</p>
                            <button id="btn-export-all" class="w-full py-2 px-4 bg-success hover:bg-green-600 text-white rounded flex items-center justify-center">
                                <i class="fas fa-download mr-2"></i>Backup Completo
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Importar Dados -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium mb-4">Importar Dados</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Importe dados a partir de arquivos CSV ou restaure um backup completo do sistema.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Importar via Modelo</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Utilize os modelos abaixo para importar novos dados:</p>
                            
                            <div class="flex flex-col space-y-3 mb-4">
    <a href="./modelos/modelo_supervisores.html" class="text-primary hover:text-secondary flex items-center">
        <i class="fas fa-file-csv mr-2"></i>Modelo de Supervisores
    </a>
    <a href="./modelos/modelo_postos.html" class="text-primary hover:text-secondary flex items-center">
        <i class="fas fa-file-csv mr-2"></i>Modelo de Postos
    </a>
    <a href="./modelos/modelo_funcionarios.html" class="text-primary hover:text-secondary flex items-center">
        <i class="fas fa-file-csv mr-2"></i>Modelo de Funcionários
    </a>
    <a href="./modelos/modelo_transferencias.html" class="text-primary hover:text-secondary flex items-center">
        <i class="fas fa-file-csv mr-2"></i>Modelo de Transferências
    </a>
</div>
                            
                            <div class="border-t border-gray-200 dark:border-gray-600 pt-4 mb-4">
                                <label for="import-file-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tipo de Dados</label>
                                <select id="import-file-type" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3">
                                    <option value="supervisors">Supervisores</option>
                                    <option value="workstations">Postos de Trabalho</option>
                                    <option value="employees">Funcionários</option>
                                    <option value="allocations">Transferências</option>
                                </select>
                                
                                <label for="import-file" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Arquivo CSV</label>
                                <div class="relative">
                                    <input type="file" id="import-file" accept=".csv" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer z-10">
                                    <div class="w-full flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white overflow-hidden">
                                        <i class="fas fa-file-upload mr-2 text-gray-500 dark:text-gray-400"></i>
                                        <span id="file-name-display" class="truncate">Nenhum arquivo escolhido</span>
                                    </div>
                                </div>
                                <p id="selected-file-info" class="mt-1 text-xs text-gray-500 dark:text-gray-400 hidden"></p>
                            </div>
                            
                            <button id="btn-import-data" class="w-full py-2 px-4 bg-warning hover:bg-amber-600 text-white rounded flex items-center justify-center">
                                <i class="fas fa-file-import mr-2"></i>Importar Dados
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Restaurar Backup</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Restaure todos os dados a partir de um arquivo de backup JSON.</p>
                            
                            <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 mb-4 bg-yellow-50 dark:bg-yellow-900/20">
                                <div class="flex items-start text-warning">
                                    <i class="fas fa-exclamation-triangle mt-0.5 mr-2"></i>
                                    <p class="text-sm">Atenção: A restauração substituirá todos os dados atuais do sistema. Recomendamos fazer um backup antes de prosseguir.</p>
                                </div>
                            </div>
                            
                            <label for="import-backup" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Arquivo de Backup (JSON)</label>
                            <div class="relative">
                                <input type="file" id="import-backup" accept=".json" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer z-10">
                                <div class="w-full flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white overflow-hidden mb-4">
                                    <i class="fas fa-file-upload mr-2 text-gray-500 dark:text-gray-400"></i>
                                    <span id="backup-file-name-display" class="truncate">Nenhum arquivo escolhido</span>
                                </div>
                                <p id="backup-file-info" class="mt-1 text-xs text-gray-500 dark:text-gray-400 hidden"></p>
                            </div>
                            
                            <button id="btn-restore-backup" class="w-full py-2 px-4 bg-danger hover:bg-red-600 text-white rounded flex items-center justify-center">
                                <i class="fas fa-undo-alt mr-2"></i>Restaurar Backup
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-white dark:bg-gray-900 py-4 px-6 shadow-inner border-t border-gray-200 dark:border-gray-800">
            <div class="container mx-auto text-center text-gray-600 dark:text-gray-400 text-sm">
                <p>Sistema de Gestão de Funcionários por Posto de Trabalho - v1.0</p>
                <p class="text-xs mt-1">© 2023 - Todos os direitos reservados</p>
            </div>
        </footer>
    </div>
    
    <!-- Modal para adicionar/editar supervisor -->
    <div id="supervisor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="supervisor-modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">Novo Supervisor</h3>
                <button id="supervisor-modal-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="supervisor-form" class="p-4">
                <input type="hidden" id="supervisor-id" value="">
                
                <div class="mb-4">
                    <label for="supervisor-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome Completo</label>
                    <input type="text" id="supervisor-name" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="supervisor-id-code" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Código/Matrícula</label>
                    <input type="text" id="supervisor-id-code" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="supervisor-workstation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Posto de Trabalho (Inicial)</label>
                    <select id="supervisor-workstation" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="">Selecione um posto</option>
                        <!-- As opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="supervisor-cancel" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-gray-900 dark:text-white">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-secondary text-white rounded-md">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para adicionar/editar posto de trabalho -->
    <div id="workstation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="workstation-modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">Novo Posto de Trabalho</h3>
                <button id="workstation-modal-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="workstation-form" class="p-4">
                <input type="hidden" id="workstation-id" value="">
                
                <div class="mb-4">
                    <label for="workstation-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome do Posto</label>
                    <input type="text" id="workstation-name" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="workstation-capacity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Capacidade (Funcionários)</label>
                    <input type="number" id="workstation-capacity" min="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="workstation-warning" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Limite de Alerta (%)</label>
                    <input type="number" id="workstation-warning" min="0" max="100" value="80" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="workstation-supervisor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Supervisor Responsável</label>
                    <select id="workstation-supervisor" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        <option value="">Selecione um supervisor</option>
                        <!-- As opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="workstation-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Descrição</label>
                    <textarea id="workstation-description" rows="3" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="workstation-cancel" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-gray-900 dark:text-white">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-secondary text-white rounded-md">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para adicionar/editar funcionário -->
    <div id="employee-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="employee-modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">Novo Funcionário</h3>
                <button id="employee-modal-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="employee-form" class="p-4">
                <input type="hidden" id="employee-id" value="">
                
                <div class="mb-4">
                    <label for="employee-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome Completo</label>
                    <input type="text" id="employee-name" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="employee-id-code" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Matrícula</label>
                    <input type="text" id="employee-id-code" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="employee-birth-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data de Nascimento</label>
                    <input type="date" id="employee-birth-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="employee-hire-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data de Admissão</label>
                    <input type="date" id="employee-hire-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="employee-position" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cargo</label>
                    <input type="text" id="employee-position" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="employee-status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                    <select id="employee-status" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        <option value="Ativo">Ativo</option>
                        <option value="Férias">Férias</option>
                        <option value="Afastado">Afastado</option>
                        <option value="Inativo">Inativo</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="employee-workstation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Posto de Trabalho</label>
                    <select id="employee-workstation" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        <option value="">Selecione um posto</option>
                        <!-- As opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="employee-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Observações</label>
                    <textarea id="employee-notes" rows="3" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="employee-cancel" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-gray-900 dark:text-white">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-success hover:bg-green-600 text-white rounded-md">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para selecionar funcionário para transferência -->
    <div id="employee-selection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Selecionar Funcionário</h3>
                <button id="employee-selection-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label for="employee-search-transfer" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Buscar Funcionário</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" id="employee-search-transfer" placeholder="Nome ou matrícula" class="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                </div>
                
                <div class="max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-md">
                    <ul id="employee-selection-list" class="divide-y divide-gray-200 dark:divide-gray-700">
                        <!-- Lista de funcionários para seleção -->
                        <li class="p-4 text-center text-gray-500 dark:text-gray-400">
                            Nenhum funcionário ativo encontrado
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para registrar transferência -->
    <div id="transfer-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Transferir Funcionário</h3>
                <button id="transfer-modal-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="transfer-form" class="p-4">
                <input type="hidden" id="transfer-employee-id" value="">
                
                <div class="mb-4">
                    <div class="mb-1 font-medium">Funcionário</div>
                    <div id="transfer-employee-name" class="py-2 px-3 bg-gray-100 dark:bg-gray-700 rounded">Nome do Funcionário</div>
                </div>
                
                <div class="mb-4">
                    <label for="transfer-supervisor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Supervisor Responsável</label>
                    <select id="transfer-supervisor" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        <option value="">Selecione o supervisor</option>
                        <!-- As opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <div class="mb-1 font-medium">Posto Atual</div>
                    <div id="transfer-current-workstation" class="py-2 px-3 bg-gray-100 dark:bg-gray-700 rounded">Nome do Posto Atual</div>
                </div>
                
                <div class="mb-4">
                    <label for="transfer-new-workstation" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Novo Posto de Trabalho</label>
                    <select id="transfer-new-workstation" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        <option value="">Selecione o novo posto</option>
                        <!-- As opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="transfer-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data da Transferência</label>
                    <input type="date" id="transfer-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                
                <div class="mb-4">
                    <label for="transfer-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Observações</label>
                    <textarea id="transfer-notes" rows="3" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Motivo da transferência"></textarea>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="transfer-cancel" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-gray-900 dark:text-white">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-warning hover:bg-amber-600 text-white rounded-md">
                        Transferir
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Modelo de dados
        const AppData = {
            supervisors: [
                {
                    id: 1,
                    name: "Supervisor Exemplo",
                    idCode: "SUP-001",
                    workstationIds: [1],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ],
            workstations: [
                {
                    id: 1,
                    name: "Posto Exemplo",
                    capacity: 5,
                    warningThreshold: 80,
                    description: "Posto de trabalho exemplo",
                    supervisorId: 1,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ],
            employees: [],
            allocations: [],
            lastSupervisorId: 1,
            lastWorkstationId: 1,
            lastEmployeeId: 0,
            lastAllocationId: 0
        };

        // MemoryStorage para simular localStorage
        const MemoryStorage = {
            data: {},
            
            setItem(key, value) {
                this.data[key] = value;
                return true;
            },
            
            getItem(key) {
                return this.data[key] || null;
            },
            
            removeItem(key) {
                delete this.data[key];
                return true;
            }
        };

        // Função para mostrar notificação
        function showNotification(message, type = 'info', autoHide = true) {
            const notificationArea = document.getElementById('notification-area');
            if (!notificationArea) return null;
            
            // Configurar classes de acordo com o tipo
            let bgColor, textColor, icon;
            
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100 dark:bg-green-900';
                    textColor = 'text-green-800 dark:text-green-200';
                    icon = '<i class="fas fa-check-circle mr-2"></i>';
                    break;
                case 'error':
                    bgColor = 'bg-red-100 dark:bg-red-900';
                    textColor = 'text-red-800 dark:text-red-200';
                    icon = '<i class="fas fa-exclamation-circle mr-2"></i>';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-100 dark:bg-yellow-900';
                    textColor = 'text-yellow-800 dark:text-yellow-200';
                    icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
                    break;
                default: // info
                    bgColor = 'bg-blue-100 dark:bg-blue-900';
                    textColor = 'text-blue-800 dark:text-blue-200';
                    icon = '<i class="fas fa-info-circle mr-2"></i>';
            }
            
            notificationArea.className = `mb-4 p-4 rounded flex items-start ${bgColor} ${textColor}`;
            notificationArea.innerHTML = `
                ${icon}
                <div class="flex-grow">${message}</div>
                <button class="ml-auto text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationArea.classList.remove('hidden');
            
            // Adicionar evento para fechar
            const closeBtn = notificationArea.querySelector('button');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    notificationArea.classList.add('hidden');
                });
            }
            
            // Auto-esconder após 5 segundos (exceto erros ou quando autoHide é false)
            if (type !== 'error' && autoHide) {
                setTimeout(() => {
                    if (notificationArea && !notificationArea.classList.contains('hidden')) {
                        notificationArea.classList.add('hidden');
                    }
                }, 5000);
            }
            
            return notificationArea;
        }

        // Formatação de dados e cálculos
        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            } catch (error) {
                console.error("Erro ao formatar data:", error);
                return dateString;
            }
        }

        function calculateAge(birthDateStr) {
            if (!birthDateStr) return 0;
            
            try {
                const birthDate = new Date(birthDateStr);
                const today = new Date();
                
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                return age;
            } catch (error) {
                console.error("Erro ao calcular idade:", error);
                return 0;
            }
        }

        function formatPercentage(value) {
            if (isNaN(value)) return "0%";
            return `${Math.round(value)}%`;
        }

        // Obter posto atual de um funcionário
        function getCurrentWorkstation(employeeId) {
            // Encontrar a alocação atual (sem data de término)
            const currentAllocation = AppData.allocations.find(a => 
                a.employeeId === employeeId && a.endDate === null
            );
            
            if (currentAllocation) {
                const workstation = AppData.workstations.find(w => w.id === currentAllocation.workstationId);
                return workstation || null;
            }
            
            return null;
        }

        // Obter supervisor de um funcionário (através do posto)
        function getSupervisorForEmployee(employeeId) {
            const workstation = getCurrentWorkstation(employeeId);
            if (workstation && workstation.supervisorId) {
                return AppData.supervisors.find(s => s.id === workstation.supervisorId) || null;
            }
            return null;
        }

        // Atualização da UI
        function updateSummaryNumbers() {
            try {
                // Total de supervisores
                const totalSupervisors = document.getElementById('total-supervisors');
                if (totalSupervisors) totalSupervisors.textContent = AppData.supervisors.length;
                
                // Total de postos
                const totalWorkstations = document.getElementById('total-workstations');
                if (totalWorkstations) totalWorkstations.textContent = AppData.workstations.length;
                
                // Total de funcionários ativos
                const activeEmployees = AppData.employees.filter(e => e.status === 'Ativo').length;
                const totalEmployees = document.getElementById('total-employees');
                if (totalEmployees) totalEmployees.textContent = activeEmployees;
                
                // Taxa de ocupação média
                let totalCapacity = 0;
                AppData.workstations.forEach(workstation => {
                    totalCapacity += workstation.capacity || 0;
                });
                
                const occupancyRate = document.getElementById('occupancy-rate');
                if (occupancyRate) {
                    const rate = totalCapacity > 0 ? (activeEmployees / totalCapacity) * 100 : 0;
                    occupancyRate.textContent = formatPercentage(rate);
                }
            } catch (error) {
                console.error("Erro ao atualizar números de resumo:", error);
            }
        }

        // Atualizar tabela de resumo de ocupação
        function updateOccupancySummary() {
            const occupancyTable = document.getElementById('occupancy-summary');
            if (!occupancyTable) return;
            
            occupancyTable.innerHTML = '';
            
            AppData.workstations.forEach(workstation => {
                // Contar funcionários alocados a este posto
                const allocatedEmployees = AppData.allocations.filter(a => 
                    a.workstationId === workstation.id && 
                    a.endDate === null
                ).length;
                
                // Encontrar supervisor
                const supervisor = AppData.supervisors.find(s => s.id === workstation.supervisorId);
                const supervisorName = supervisor ? supervisor.name : 'Não atribuído';
                
                // Calcular taxa de ocupação
                const occupancyRate = workstation.capacity > 0 
                    ? (allocatedEmployees / workstation.capacity) * 100 
                    : 0;
                
                // Determinar status com base no limite de alerta
                let statusClass, statusText;
                if (occupancyRate >= workstation.warningThreshold) {
                    statusClass = 'text-warning';
                    statusText = 'Próximo do limite';
                    if (occupancyRate >= 100) {
                        statusClass = 'text-danger';
                        statusText = 'Capacidade máxima';
                    }
                } else {
                    statusClass = 'text-success';
                    statusText = 'Disponível';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${workstation.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${supervisorName}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${allocatedEmployees} / ${workstation.capacity}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="${statusClass}">
                            <i class="fas fa-circle mr-1 text-xs"></i>
                            ${statusText}
                        </span>
                    </td>
                `;
                
                occupancyTable.appendChild(row);
            });
        }

        // Atualizar resumo de supervisores
        function updateSupervisorsSummary() {
            const supervisorsTable = document.getElementById('supervisors-summary');
            if (!supervisorsTable) return;
            
            supervisorsTable.innerHTML = '';
            
            AppData.supervisors.forEach(supervisor => {
                // Contar postos de trabalho gerenciados por este supervisor
                const supervisorWorkstations = AppData.workstations.filter(w => 
                    w.supervisorId === supervisor.id
                );
                
                // Contar funcionários sob este supervisor
                const supervisorEmployees = AppData.allocations.filter(a => {
                    const workstation = AppData.workstations.find(w => w.id === a.workstationId);
                    return workstation && 
                           workstation.supervisorId === supervisor.id && 
                           a.endDate === null;
                }).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${supervisor.idCode}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${supervisor.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${supervisorWorkstations.length}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${supervisorEmployees}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <button class="text-primary hover:text-secondary" onclick="editSupervisor(${supervisor.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-danger hover:text-red-700 ml-2" onclick="deleteSupervisor(${supervisor.id})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                supervisorsTable.appendChild(row);
            });
        }

        // Atualizar lista de funcionários
        function updateEmployeeList() {
            const employeeList = document.getElementById('employee-list');
            if (!employeeList) return;
            
            // Obter filtros
            const searchTerm = document.getElementById('employee-search')?.value?.toLowerCase() || '';
            const statusFilter = document.getElementById('employee-status-filter')?.value || '';
            const workstationFilter = document.getElementById('employee-workstation-filter')?.value || '';
            
            // Filtrar funcionários
            let filteredEmployees = AppData.employees;
            
            if (searchTerm) {
                filteredEmployees = filteredEmployees.filter(employee => 
                    employee.name.toLowerCase().includes(searchTerm) || 
                    employee.idCode.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredEmployees = filteredEmployees.filter(employee => employee.status === statusFilter);
            }
            
            if (workstationFilter) {
                filteredEmployees = filteredEmployees.filter(employee => {
                    const currentWorkstation = getCurrentWorkstation(employee.id);
                    return currentWorkstation && currentWorkstation.id.toString() === workstationFilter;
                });
            }
            
            // Limpar tabela e mostrar mensagem se não houver funcionários
            if (filteredEmployees.length === 0) {
                employeeList.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            <p class="mb-2">${searchTerm || statusFilter || workstationFilter ? 'Nenhum funcionário encontrado com os filtros aplicados' : 'Nenhum funcionário cadastrado'}</p>
                            ${!searchTerm && !statusFilter && !workstationFilter ? `
                                <button id="add-first-employee-2" class="px-4 py-2 bg-success hover:bg-green-600 text-white rounded-md">
                                    <i class="fas fa-user-plus mr-1"></i>Adicionar Funcionário
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
                
                // Adicionar listener ao botão de adicionar primeiro funcionário
                const addFirstBtn = document.getElementById('add-first-employee-2');
                if (addFirstBtn) {
                    addFirstBtn.addEventListener('click', showEmployeeModal);
                }
                
                return;
            }
            
            // Preencher tabela com funcionários filtrados
            employeeList.innerHTML = '';
            filteredEmployees.forEach(employee => {
                const currentWorkstation = getCurrentWorkstation(employee.id);
                const workstationName = currentWorkstation ? currentWorkstation.name : 'Não alocado';
                
                // Definir classe de status
                let statusClass;
                switch (employee.status) {
                    case 'Ativo':
                        statusClass = 'text-success';
                        break;
                    case 'Férias':
                        statusClass = 'text-primary';
                        break;
                    case 'Afastado':
                        statusClass = 'text-warning';
                        break;
                    case 'Inativo':
                        statusClass = 'text-danger';
                        break;
                    default:
                        statusClass = 'text-gray-500';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${employee.idCode}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${employee.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${employee.position}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${formatDate(employee.hireDate)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${workstationName}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="${statusClass}">
                            <i class="fas fa-circle mr-1 text-xs"></i>
                            ${employee.status}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <button class="text-primary hover:text-secondary" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-danger hover:text-red-700 ml-2" onclick="deleteEmployee(${employee.id})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                employeeList.appendChild(row);
            });
        }

        // Atualizar lista de transferências
        function updateAllocationsList() {
            const transferHistory = document.getElementById('transfer-history');
            if (!transferHistory) return;
            
            // Obter filtros
            const searchTerm = document.getElementById('transfer-search')?.value?.toLowerCase() || '';
            const workstationFilter = document.getElementById('transfer-workstation')?.value || '';
            const dateStart = document.getElementById('transfer-date-start')?.value || '';
            const dateEnd = document.getElementById('transfer-date-end')?.value || '';
            
            // Construir lista com todas as transferências (início e fim de cada alocação)
            let allTransfers = [];
            
            // Para cada alocação, adicionar eventos de início e fim
            AppData.allocations.forEach(allocation => {
                const employee = AppData.employees.find(e => e.id === allocation.employeeId);
                if (!employee) return; // Pular se o funcionário não existir
                
                const workstation = AppData.workstations.find(w => w.id === allocation.workstationId);
                if (!workstation) return; // Pular se o posto não existir
                
                // Adicionar evento de início
                allTransfers.push({
                    date: allocation.startDate,
                    employeeId: employee.id,
                    employeeName: employee.name,
                    employeeCode: employee.idCode,
                    workstationId: workstation.id,
                    workstationName: workstation.name,
                    type: 'start',
                    notes: allocation.notes || '',
                    allocationId: allocation.id
                });
                
                // Se tiver data de término, adicionar também
                if (allocation.endDate) {
                    allTransfers.push({
                        date: allocation.endDate,
                        employeeId: employee.id,
                        employeeName: employee.name,
                        employeeCode: employee.idCode,
                        workstationId: workstation.id,
                        workstationName: workstation.name,
                        type: 'end',
                        notes: allocation.notes || '',
                        allocationId: allocation.id
                    });
                }
            });
            
            // Ordenar por data (mais recente primeiro)
            allTransfers.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Aplicar filtros
            if (searchTerm) {
                allTransfers = allTransfers.filter(transfer => 
                    transfer.employeeName.toLowerCase().includes(searchTerm) || 
                    transfer.employeeCode.toLowerCase().includes(searchTerm)
                );
            }
            
            if (workstationFilter) {
                allTransfers = allTransfers.filter(transfer => 
                    transfer.workstationId.toString() === workstationFilter
                );
            }
            
            if (dateStart) {
                const startDate = new Date(dateStart);
                allTransfers = allTransfers.filter(transfer => 
                    new Date(transfer.date) >= startDate
                );
            }
            
            if (dateEnd) {
                const endDate = new Date(dateEnd);
                // Ajustar para final do dia
                endDate.setHours(23, 59, 59, 999);
                allTransfers = allTransfers.filter(transfer => 
                    new Date(transfer.date) <= endDate
                );
            }
            
            // Processar os eventos para criar uma lista de transferências
            const transfers = [];
            
            // Para cada evento "fim", tentar encontrar a próxima alocação do funcionário
            allTransfers.forEach((currentTransfer, index) => {
                if (currentTransfer.type === 'start') {
                    // Encontrar a alocação anterior (se houver)
                    const previousEnd = allTransfers
                        .filter(t => 
                            t.employeeId === currentTransfer.employeeId && 
                            t.type === 'end' && 
                            new Date(t.date) <= new Date(currentTransfer.date)
                        )
                        .sort((a, b) => new Date(b.date) - new Date(a.date))[0]; // Pegar a mais recente
                    
                    if (previousEnd) {
                        // Se encontrou um fim anterior, temos uma transferência
                        transfers.push({
                            date: currentTransfer.date,
                            employeeId: currentTransfer.employeeId,
                            employeeName: currentTransfer.employeeName,
                            fromWorkstationId: previousEnd.workstationId,
                            fromWorkstationName: previousEnd.workstationName,
                            toWorkstationId: currentTransfer.workstationId,
                            toWorkstationName: currentTransfer.workstationName,
                            notes: currentTransfer.notes
                        });
                    } else {
                        // Se não encontrou, é a primeira alocação (entrada)
                        transfers.push({
                            date: currentTransfer.date,
                            employeeId: currentTransfer.employeeId,
                            employeeName: currentTransfer.employeeName,
                            fromWorkstationId: null,
                            fromWorkstationName: 'Entrada no sistema',
                            toWorkstationId: currentTransfer.workstationId,
                            toWorkstationName: currentTransfer.workstationName,
                            notes: currentTransfer.notes
                        });
                    }
                } else if (currentTransfer.type === 'end') {
                    // Verificar se não tem uma alocação seguinte
                    const nextStart = allTransfers
                        .filter(t => 
                            t.employeeId === currentTransfer.employeeId && 
                            t.type === 'start' && 
                            new Date(t.date) >= new Date(currentTransfer.date)
                        )
                        .sort((a, b) => new Date(a.date) - new Date(b.date))[0]; // Pegar a mais próxima
                    
                    if (!nextStart) {
                        // Se não encontrou próxima alocação, é saída definitiva ou atual
                        transfers.push({
                            date: currentTransfer.date,
                            employeeId: currentTransfer.employeeId,
                            employeeName: currentTransfer.employeeName,
                            fromWorkstationId: currentTransfer.workstationId,
                            fromWorkstationName: currentTransfer.workstationName,
                            toWorkstationId: null,
                            toWorkstationName: 'Saída do sistema',
                            notes: currentTransfer.notes
                        });
                    }
                    // Se encontrou próxima alocação, já foi processado quando encontramos o 'start'
                }
            });
            
            // Ordenar transferências por data (mais recente primeiro)
            transfers.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Limpar tabela e mostrar mensagem se não houver transferências
            if (transfers.length === 0) {
                transferHistory.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            <p class="mb-2">Nenhuma transferência registrada</p>
                            ${!searchTerm && !workstationFilter && !dateStart && !dateEnd && AppData.employees.length > 0 ? `
                                <button id="add-first-allocation-2" class="px-4 py-2 bg-warning hover:bg-amber-600 text-white rounded-md">
                                    <i class="fas fa-exchange-alt mr-1"></i>Registrar Transferência
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
                
                // Adicionar listener ao botão
                const addFirstBtn = document.getElementById('add-first-allocation-2');
                if (addFirstBtn) {
                    addFirstBtn.addEventListener('click', showEmployeeSelectionModal);
                }
                
                return;
            }
            
            // Preencher tabela com transferências
            transferHistory.innerHTML = '';
            transfers.forEach(transfer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${formatDate(transfer.date)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${transfer.employeeName}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${transfer.fromWorkstationName}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${transfer.toWorkstationName}</td>
                    <td class="px-4 py-3">${transfer.notes}</td>
                `;
                
                transferHistory.appendChild(row);
            });
        }

        // Atualizar grid de supervisores
        function updateSupervisorsGrid() {
            const supervisorsGrid = document.getElementById('supervisors-grid');
            if (!supervisorsGrid) return;
            
            // Obter filtros
            const searchTerm = document.getElementById('supervisor-search')?.value?.toLowerCase() || '';
            const workstationFilter = document.getElementById('supervisor-workstation-filter')?.value || '';
            
            // Filtrar supervisores
            let filteredSupervisors = AppData.supervisors;
            
            if (searchTerm) {
                filteredSupervisors = filteredSupervisors.filter(supervisor => 
                    supervisor.name.toLowerCase().includes(searchTerm) || 
                    supervisor.idCode.toLowerCase().includes(searchTerm)
                );
            }
            
            if (workstationFilter) {
                filteredSupervisors = filteredSupervisors.filter(supervisor => {
                    const workstation = AppData.workstations.find(w => 
                        w.id.toString() === workstationFilter && 
                        w.supervisorId === supervisor.id
                    );
                    return !!workstation;
                });
            }
            
            // Limpar grid e mostrar mensagem se não houver supervisores
            supervisorsGrid.innerHTML = '';
            
            if (filteredSupervisors.length === 0) {
                supervisorsGrid.innerHTML = `
                    <div class="col-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center">
                        <p class="text-gray-500 dark:text-gray-400 mb-4">
                            ${searchTerm || workstationFilter ? 'Nenhum supervisor encontrado com os filtros aplicados' : 'Nenhum supervisor cadastrado'}
                        </p>
                        ${!searchTerm && !workstationFilter ? `
                            <button id="add-first-supervisor" class="px-4 py-2 bg-primary hover:bg-secondary text-white rounded-md">
                                <i class="fas fa-user-tie mr-1"></i>Adicionar Supervisor
                            </button>
                        ` : ''}
                    </div>
                `;
                
                // Adicionar listener ao botão
                const addFirstBtn = document.getElementById('add-first-supervisor');
                if (addFirstBtn) {
                    addFirstBtn.addEventListener('click', showSupervisorModal);
                }
                
                return;
            }
            
            // Preencher grid com cards de supervisores
            filteredSupervisors.forEach(supervisor => {
                // Contar postos de trabalho gerenciados
                const supervisorWorkstations = AppData.workstations.filter(w => 
                    w.supervisorId === supervisor.id
                );
                
                // Contar funcionários sob supervisão
                const supervisorEmployees = AppData.allocations.filter(a => {
                    const workstation = AppData.workstations.find(w => w.id === a.workstationId);
                    return workstation && 
                           workstation.supervisorId === supervisor.id && 
                           a.endDate === null;
                }).length;
                
                // Calcular taxa de ocupação média
                let totalCapacity = 0;
                supervisorWorkstations.forEach(workstation => {
                    totalCapacity += workstation.capacity || 0;
                });
                
                const occupancyRate = totalCapacity > 0 ? (supervisorEmployees / totalCapacity) * 100 : 0;
                
                // Definir status com base na taxa de ocupação
                let statusClass, statusText;
                if (occupancyRate >= 80) {
                    statusClass = 'text-warning';
                    statusText = 'Alta Ocupação';
                    if (occupancyRate >= 95) {
                        statusClass = 'text-danger';
                        statusText = 'Crítica';
                    }
                } else if (occupancyRate >= 50) {
                    statusClass = 'text-success';
                    statusText = 'Normal';
                } else {
                    statusClass = 'text-primary';
                    statusText = 'Baixa Ocupação';
                }
                
                // Criar card para o supervisor
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden';
                card.innerHTML = `
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <div>
                            <h3 class="font-medium">${supervisor.name}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${supervisor.idCode}</p>
                        </div>
                        <span class="${statusClass} text-sm">
                            <i class="fas fa-circle mr-1 text-xs"></i>${statusText}
                        </span>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Postos</p>
                                <p class="text-xl font-bold">${supervisorWorkstations.length}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Funcionários</p>
                                <p class="text-xl font-bold">${supervisorEmployees}</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm text-gray-500 dark:text-gray-400">Ocupação</span>
                                <span class="text-sm font-medium">${formatPercentage(occupancyRate)}</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div class="h-2 rounded-full ${statusClass === 'text-danger' ? 'bg-danger' : statusClass === 'text-warning' ? 'bg-warning' : 'bg-success'}" style="width: ${Math.min(100, occupancyRate)}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 text-right">
                        <button class="text-primary hover:text-secondary" onclick="showSupervisorDetails(${supervisor.id})">
                            Ver detalhes <i class="fas fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                `;
                
                supervisorsGrid.appendChild(card);
            });
        }

        // Atualizar detalhes do supervisor
        function showSupervisorDetails(supervisorId) {
            const supervisorDetails = document.getElementById('supervisor-details');
            if (!supervisorDetails) return;
            
            // Encontrar supervisor
            const supervisor = AppData.supervisors.find(s => s.id === supervisorId);
            if (!supervisor) {
                showNotification('Supervisor não encontrado', 'error');
                return;
            }
            
            // Mostrar seção de detalhes
            supervisorDetails.classList.remove('hidden');
            
            // Atualizar cabeçalho
            document.getElementById('detail-supervisor-name').textContent = supervisor.name;
            document.getElementById('detail-supervisor-code').textContent = `Matrícula: ${supervisor.idCode}`;
            
            // Configurar botões de ação
            document.getElementById('btn-edit-detail-supervisor').onclick = () => editSupervisor(supervisor.id);
            document.getElementById('btn-delete-detail-supervisor').onclick = () => deleteSupervisor(supervisor.id);
            
            // Obter postos gerenciados
            const supervisorWorkstations = AppData.workstations.filter(w => w.supervisorId === supervisor.id);
            document.getElementById('detail-supervisor-workstations-count').textContent = supervisorWorkstations.length;
            
            // Obter funcionários sob supervisão
            const employeesUnderSupervisor = [];
            AppData.allocations.forEach(allocation => {
                if (allocation.endDate === null) { // Somente alocações ativas
                    const workstation = AppData.workstations.find(w => 
                        w.id === allocation.workstationId && w.supervisorId === supervisor.id
                    );
                    
                    if (workstation) {
                        const employee = AppData.employees.find(e => e.id === allocation.employeeId);
                        if (employee) {
                            employeesUnderSupervisor.push({
                                ...employee,
                                workstation
                            });
                        }
                    }
                }
            });
            
            document.getElementById('detail-supervisor-employees-count').textContent = employeesUnderSupervisor.length;
            
            // Calcular ocupação total
            let totalCapacity = 0;
            supervisorWorkstations.forEach(workstation => {
                totalCapacity += workstation.capacity || 0;
            });
            
            const occupancyRate = totalCapacity > 0 ? (employeesUnderSupervisor.length / totalCapacity) * 100 : 0;
            document.getElementById('detail-supervisor-occupancy').textContent = formatPercentage(occupancyRate);
            
            // Preencher tabela de postos
            const workstationsTable = document.getElementById('detail-supervisor-workstations');
            workstationsTable.innerHTML = '';
            
            if (supervisorWorkstations.length === 0) {
                workstationsTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-3 text-center text-gray-500 dark:text-gray-400">
                            Nenhum posto de trabalho sob supervisão
                        </td>
                    </tr>
                `;
            } else {
                supervisorWorkstations.forEach(workstation => {
                    // Contar funcionários alocados a este posto
                    const allocatedEmployees = AppData.allocations.filter(a => 
                        a.workstationId === workstation.id && 
                        a.endDate === null
                    ).length;
                    
                    // Calcular taxa de ocupação
                    const occupancyRate = workstation.capacity > 0 
                        ? (allocatedEmployees / workstation.capacity) * 100 
                        : 0;
                    
                    // Determinar status com base no limite de alerta
                    let statusClass, statusText;
                    if (occupancyRate >= workstation.warningThreshold) {
                        statusClass = 'text-warning';
                        statusText = 'Próximo do limite';
                        if (occupancyRate >= 100) {
                            statusClass = 'text-danger';
                            statusText = 'Capacidade máxima';
                        }
                    } else {
                        statusClass = 'text-success';
                        statusText = 'Disponível';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">${workstation.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-center">${workstation.capacity}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-center">${allocatedEmployees} / ${workstation.capacity}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="${statusClass}">
                                <i class="fas fa-circle mr-1 text-xs"></i>
                                ${statusText}
                            </span>
                        </td>
                    `;
                    
                    workstationsTable.appendChild(row);
                });
            }
            
            // Preencher tabela de funcionários
            const employeesTable = document.getElementById('detail-supervisor-employees');
            employeesTable.innerHTML = '';
            
            if (employeesUnderSupervisor.length === 0) {
                employeesTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-3 text-center text-gray-500 dark:text-gray-400">
                            Nenhum funcionário sob supervisão
                        </td>
                    </tr>
                `;
            } else {
                employeesUnderSupervisor.forEach(employee => {
                    // Definir classe de status
                    let statusClass;
                    switch (employee.status) {
                        case 'Ativo':
                            statusClass = 'text-success';
                            break;
                        case 'Férias':
                            statusClass = 'text-primary';
                            break;
                        case 'Afastado':
                            statusClass = 'text-warning';
                            break;
                        case 'Inativo':
                            statusClass = 'text-danger';
                            break;
                        default:
                            statusClass = 'text-gray-500';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">${employee.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${employee.position}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${employee.workstation.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="${statusClass}">
                                <i class="fas fa-circle mr-1 text-xs"></i>
                                ${employee.status}
                            </span>
                        </td>
                    `;
                    
                    employeesTable.appendChild(row);
                });
            }
            
            // Atualizar gráfico de ocupação
            updateSupervisorOccupancyChart();
        }

        // Criar gráfico de ocupação por supervisor
        function updateSupervisorOccupancyChart() {
            const chartContainer = document.getElementById('supervisor-chart-bars');
            if (!chartContainer) return;
            
            chartContainer.innerHTML = '';
            
            // Calcular dados para o gráfico
            const supervisorData = [];
            
            AppData.supervisors.forEach(supervisor => {
                // Contar postos de trabalho gerenciados
                const supervisorWorkstations = AppData.workstations.filter(w => 
                    w.supervisorId === supervisor.id
                );
                
                // Calcular capacidade total
                let totalCapacity = 0;
                supervisorWorkstations.forEach(workstation => {
                    totalCapacity += workstation.capacity || 0;
                });
                
                // Contar funcionários sob supervisão
                const supervisorEmployees = AppData.allocations.filter(a => {
                    const workstation = AppData.workstations.find(w => w.id === a.workstationId);
                    return workstation && 
                           workstation.supervisorId === supervisor.id && 
                           a.endDate === null;
                }).length;
                
                // Calcular taxa de ocupação
                const occupancyRate = totalCapacity > 0 ? (supervisorEmployees / totalCapacity) * 100 : 0;
                
                supervisorData.push({
                    id: supervisor.id,
                    name: supervisor.name,
                    code: supervisor.idCode,
                    workstations: supervisorWorkstations.length,
                    employees: supervisorEmployees,
                    capacity: totalCapacity,
                    occupancyRate: occupancyRate
                });
            });
            
            // Ordenar por taxa de ocupação (decrescente)
            supervisorData.sort((a, b) => b.occupancyRate - a.occupancyRate);
            
            // Criar barras para cada supervisor
            supervisorData.forEach(data => {
                // Determinar cor com base na taxa de ocupação
                let barColor;
                if (data.occupancyRate >= 90) {
                    barColor = 'bg-danger';
                } else if (data.occupancyRate >= 70) {
                    barColor = 'bg-warning';
                } else {
                    barColor = 'bg-success';
                }
                
                // Altura mínima para barras vazias
                const barHeight = Math.max(5, data.occupancyRate);
                
                const bar = document.createElement('div');
                bar.className = 'flex flex-col items-center';
                bar.innerHTML = `
                    <div class="text-xs text-center mb-1">${formatPercentage(data.occupancyRate)}</div>
                    <div class="${barColor} w-12 rounded-t" style="height: ${barHeight}%">
                    </div>
                    <div class="text-xs text-center mt-1 truncate w-20" title="${data.name}">${data.name.split(' ')[0]}</div>
                `;
                
                // Adicionar tooltip com informações completas
                bar.setAttribute('title', `
                    ${data.name} (${data.code})
                    Postos: ${data.workstations}
                    Funcionários: ${data.employees}
                    Ocupação: ${formatPercentage(data.occupancyRate)}
                `);
                
                // Adicionar evento para mostrar detalhes
                bar.style.cursor = 'pointer';
                bar.addEventListener('click', () => showSupervisorDetails(data.id));
                
                chartContainer.appendChild(bar);
            });
        }

        // Atualizar filtros nos dropdowns
        function updateFilters() {
            // Filtro de posto de trabalho para funcionários
            const workstationFilter = document.getElementById('employee-workstation-filter');
            if (workstationFilter) {
                const currentValue = workstationFilter.value;
                workstationFilter.innerHTML = '<option value="">Todos</option>';
                
                AppData.workstations.forEach(workstation => {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = workstation.name;
                    workstationFilter.appendChild(option);
                });
                
                if (currentValue) {
                    workstationFilter.value = currentValue;
                }
            }
            
            // Filtro de posto para transferências
            const transferWorkstationFilter = document.getElementById('transfer-workstation');
            if (transferWorkstationFilter) {
                const currentValue = transferWorkstationFilter.value;
                transferWorkstationFilter.innerHTML = '<option value="">Todos os postos</option>';
                
                AppData.workstations.forEach(workstation => {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = workstation.name;
                    transferWorkstationFilter.appendChild(option);
                });
                
                if (currentValue) {
                    transferWorkstationFilter.value = currentValue;
                }
            }
            
            // Filtro de posto para relatório mensal
            const monthlyReportWorkstation = document.getElementById('monthly-report-workstation');
            if (monthlyReportWorkstation) {
                const currentValue = monthlyReportWorkstation.value;
                monthlyReportWorkstation.innerHTML = '<option value="">Todos os postos</option>';
                
                AppData.workstations.forEach(workstation => {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = workstation.name;
                    monthlyReportWorkstation.appendChild(option);
                });
                
                if (currentValue) {
                    monthlyReportWorkstation.value = currentValue;
                }
            }
            
            // Filtro de posto para supervisores
            const supervisorWorkstationFilter = document.getElementById('supervisor-workstation-filter');
            if (supervisorWorkstationFilter) {
                const currentValue = supervisorWorkstationFilter.value;
                supervisorWorkstationFilter.innerHTML = '<option value="">Todos os postos</option>';
                
                AppData.workstations.forEach(workstation => {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = workstation.name;
                    supervisorWorkstationFilter.appendChild(option);
                });
                
                if (currentValue) {
                    supervisorWorkstationFilter.value = currentValue;
                }
            }
        }

        function updateWorkstationsList() {
            // Implementação original...
        }

        function updateWorkstationFilters() {
            // Implementação original...
        }

        function updateUI() {
            updateSummaryNumbers();
            updateOccupancySummary();
            updateSupervisorsSummary();
            updateEmployeeList();
            updateAllocationsList();
            updateSupervisorsGrid();
            updateWorkstationsList();
            updateFilters();
            updateWorkstationFilters();
        }

        // Funções de autenticação
        let isUserLoggedIn = false;

        function login() {
            console.log("Executando função de login");
            try {
                isUserLoggedIn = true;
                
                // Esconder tela de login e mostrar sistema - com verificação de erros
                const loginScreen = document.getElementById('login-screen');
                const appContainer = document.getElementById('app-container');
                
                if (!loginScreen || !appContainer) {
                    console.error("Elementos login-screen ou app-container não encontrados");
                    alert("Erro ao alternar telas. Por favor, recarregue a página.");
                    return;
                }
                
                loginScreen.style.display = "none"; // Usar display:none como fallback
                loginScreen.classList.add('hidden');
                
                appContainer.style.display = "flex"; // Usar display:flex como fallback
                appContainer.classList.remove('hidden');
                
                // Mostrar notificação
                console.log("Mostrando notificação de login bem-sucedido");
                showNotification('Login realizado com sucesso! Bem-vindo, admin.', 'success');
                
                // Mostrar dashboard com verificação de erros
                const dashboardSection = document.getElementById('dashboard-section');
                if (dashboardSection) {
                    console.log("Exibindo dashboard");
                    showSection('dashboard-section');
                } else {
                    console.error("Seção dashboard-section não encontrada");
                }
                
                // Atualizar UI
                console.log("Atualizando UI");
                updateUI();
                
                console.log("Login concluído com sucesso");
            } catch (error) {
                console.error("Erro durante o login:", error);
                alert("Ocorreu um erro durante o login: " + error.message);
            }
        }
        
        function logout() {
            isUserLoggedIn = false;
            
            // Esconder sistema e mostrar tela de login
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            
            // Limpar campos de login
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
        }

        // Função para mostrar uma seção e esconder as outras
        function showSection(sectionId) {
            console.log("Mostrando seção:", sectionId);
            // Esconder todas as seções
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar a seção selecionada
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
            }
            
            // Atualizar estilos dos botões de navegação
            const navButtons = [
                { id: 'btn-dashboard', section: 'dashboard-section' },
                { id: 'btn-employee-list', section: 'employee-list-section' },
                { id: 'btn-allocation-history', section: 'allocation-history-section' },
                { id: 'btn-supervisor-management', section: 'supervisor-management-section' },
                { id: 'btn-workstation-management', section: 'workstation-management-section' },
                { id: 'btn-import-export', section: 'import-export-section' }
            ];
            
            navButtons.forEach(button => {
                const el = document.getElementById(button.id);
                if (el) {
                    if (button.section === sectionId) {
                        el.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                        el.classList.add('bg-primary', 'text-white');
                    } else {
                        el.classList.add('bg-gray-200', 'dark:bg-gray-700');
                        el.classList.remove('bg-primary', 'text-white');
                    }
                }
            });
            
            // Ações específicas para cada seção
            if (sectionId === 'employee-list-section') {
                updateEmployeeList();
                updateFilters();
            } else if (sectionId === 'allocation-history-section') {
                updateAllocationsList();
                updateFilters();
                
                // Inicializar o mês atual em relatórios mensais
                const monthlyReportMonthInput = document.getElementById('monthly-report-month');
                if (monthlyReportMonthInput && !monthlyReportMonthInput.value) {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    monthlyReportMonthInput.value = `${year}-${month}`;
                }
            } else if (sectionId === 'supervisor-management-section') {
                updateSupervisorsGrid();
                updateFilters();
                
                // Ocultar detalhes do supervisor ao trocar para esta seção
                const supervisorDetails = document.getElementById('supervisor-details');
                if (supervisorDetails) {
                    supervisorDetails.classList.add('hidden');
                }
            }
        }
        
        // Funções para o modal de supervisor
        function showSupervisorModal(supervisorId = null) {
            console.log("Abrindo modal de supervisor, ID:", supervisorId);
            
            // Limpar o formulário
            document.getElementById('supervisor-form').reset();
            document.getElementById('supervisor-id').value = '';
            
            // Preencher o dropdown de postos de trabalho
            const workstationSelect = document.getElementById('supervisor-workstation');
            workstationSelect.innerHTML = '<option value="">Selecione um posto</option>';
            
            AppData.workstations.forEach(workstation => {
                const option = document.createElement('option');
                option.value = workstation.id;
                option.textContent = workstation.name;
                workstationSelect.appendChild(option);
            });
            
            // Se for edição, preencher os campos com os dados do supervisor
            if (supervisorId) {
                const supervisor = AppData.supervisors.find(s => s.id === supervisorId);
                if (supervisor) {
                    document.getElementById('supervisor-modal-title').textContent = 'Editar Supervisor';
                    document.getElementById('supervisor-id').value = supervisor.id;
                    document.getElementById('supervisor-name').value = supervisor.name;
                    document.getElementById('supervisor-id-code').value = supervisor.idCode;
                    
                    // Selecionar o primeiro posto associado ao supervisor (se houver)
                    if (supervisor.workstationIds && supervisor.workstationIds.length > 0) {
                        workstationSelect.value = supervisor.workstationIds[0];
                    }
                }
            } else {
                document.getElementById('supervisor-modal-title').textContent = 'Novo Supervisor';
            }
            
            // Mostrar o modal
            document.getElementById('supervisor-modal').classList.remove('hidden');
        }
        
        function hideSupervisorModal() {
            document.getElementById('supervisor-modal').classList.add('hidden');
        }
        
        function saveSupervisor(event) {
            event.preventDefault();
            
            try {
                const supervisorId = document.getElementById('supervisor-id').value;
                const name = document.getElementById('supervisor-name').value;
                const idCode = document.getElementById('supervisor-id-code').value;
                const workstationId = document.getElementById('supervisor-workstation').value;
                
                if (!name || !idCode) {
                    showNotification('Por favor, preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                const now = new Date().toISOString();
                
                if (supervisorId) {
                    // Edição de supervisor existente
                    const index = AppData.supervisors.findIndex(s => s.id === parseInt(supervisorId));
                    if (index !== -1) {
                        const supervisor = AppData.supervisors[index];
                        supervisor.name = name;
                        supervisor.idCode = idCode;
                        supervisor.updatedAt = now;
                        
                        // Atualizar associação de postos de trabalho
                        if (workstationId) {
                            if (!supervisor.workstationIds.includes(parseInt(workstationId))) {
                                supervisor.workstationIds.push(parseInt(workstationId));
                            }
                        }
                        
                        showNotification('Supervisor atualizado com sucesso', 'success');
                    }
                } else {
                    // Novo supervisor
                    const newId = AppData.lastSupervisorId + 1;
                    const newSupervisor = {
                        id: newId,
                        name: name,
                        idCode: idCode,
                        workstationIds: workstationId ? [parseInt(workstationId)] : [],
                        createdAt: now,
                        updatedAt: now
                    };
                    
                    AppData.supervisors.push(newSupervisor);
                    AppData.lastSupervisorId = newId;
                    
                    showNotification('Supervisor criado com sucesso', 'success');
                }
                
                // Atualizar UI
                updateUI();
                
                // Fechar modal
                hideSupervisorModal();
            } catch (error) {
                console.error('Erro ao salvar supervisor:', error);
                showNotification('Ocorreu um erro ao salvar o supervisor: ' + error.message, 'error');
            }
        }
        
        function editSupervisor(supervisorId) {
            showSupervisorModal(supervisorId);
        }
        
        function deleteSupervisor(supervisorId) {
            try {
                // Verificar se o supervisor existe
                const supervisor = AppData.supervisors.find(s => s.id === supervisorId);
                if (!supervisor) {
                    showNotification('Supervisor não encontrado', 'error');
                    return;
                }
                
                // Verificar se há postos de trabalho associados
                const hasWorkstations = AppData.workstations.some(w => w.supervisorId === supervisorId);
                if (hasWorkstations) {
                    showNotification('Não é possível excluir um supervisor com postos de trabalho associados', 'warning');
                    return;
                }
                
                // Remover o supervisor
                AppData.supervisors = AppData.supervisors.filter(s => s.id !== supervisorId);
                
                showNotification('Supervisor excluído com sucesso', 'success');
                
                // Atualizar UI
                updateUI();
                
                // Se estiver visualizando os detalhes, ocultar
                const supervisorDetails = document.getElementById('supervisor-details');
                if (supervisorDetails && !supervisorDetails.classList.contains('hidden')) {
                    supervisorDetails.classList.add('hidden');
                }
            } catch (error) {
                console.error('Erro ao excluir supervisor:', error);
                showNotification('Ocorreu um erro ao excluir o supervisor: ' + error.message, 'error');
            }
        }
        
        // Funções para o modal de posto de trabalho
        function showWorkstationModal(workstationId = null) {
            console.log("Abrindo modal de posto de trabalho, ID:", workstationId);
            
            // Limpar o formulário
            document.getElementById('workstation-form').reset();
            document.getElementById('workstation-id').value = '';
            
            // Preencher o dropdown de supervisores
            const supervisorSelect = document.getElementById('workstation-supervisor');
            supervisorSelect.innerHTML = '<option value="">Selecione um supervisor</option>';
            
            AppData.supervisors.forEach(supervisor => {
                const option = document.createElement('option');
                option.value = supervisor.id;
                option.textContent = supervisor.name;
                supervisorSelect.appendChild(option);
            });
            
            // Se for edição, preencher os campos com os dados do posto de trabalho
            if (workstationId) {
                const workstation = AppData.workstations.find(w => w.id === workstationId);
                if (workstation) {
                    document.getElementById('workstation-modal-title').textContent = 'Editar Posto de Trabalho';
                    document.getElementById('workstation-id').value = workstation.id;
                    document.getElementById('workstation-name').value = workstation.name;
                    document.getElementById('workstation-capacity').value = workstation.capacity;
                    document.getElementById('workstation-warning').value = workstation.warningThreshold;
                    document.getElementById('workstation-description').value = workstation.description || '';
                    
                    if (workstation.supervisorId) {
                        supervisorSelect.value = workstation.supervisorId;
                    }
                }
            } else {
                document.getElementById('workstation-modal-title').textContent = 'Novo Posto de Trabalho';
            }
            
            // Mostrar o modal
            document.getElementById('workstation-modal').classList.remove('hidden');
        }
        
        function hideWorkstationModal() {
            document.getElementById('workstation-modal').classList.add('hidden');
        }
        
        function saveWorkstation(event) {
            event.preventDefault();
            
            try {
                const workstationId = document.getElementById('workstation-id').value;
                const name = document.getElementById('workstation-name').value;
                const capacity = parseInt(document.getElementById('workstation-capacity').value);
                const warningThreshold = parseInt(document.getElementById('workstation-warning').value);
                const supervisorId = parseInt(document.getElementById('workstation-supervisor').value);
                const description = document.getElementById('workstation-description').value;
                
                if (!name || isNaN(capacity) || capacity <= 0 || isNaN(supervisorId)) {
                    showNotification('Por favor, preencha todos os campos obrigatórios corretamente', 'warning');
                    return;
                }
                
                const now = new Date().toISOString();
                
                if (workstationId) {
                    // Edição de posto de trabalho existente
                    const index = AppData.workstations.findIndex(w => w.id === parseInt(workstationId));
                    if (index !== -1) {
                        const workstation = AppData.workstations[index];
                        
                        // Atualizar os dados do posto
                        workstation.name = name;
                        workstation.capacity = capacity;
                        workstation.warningThreshold = warningThreshold;
                        workstation.description = description;
                        workstation.updatedAt = now;
                        
                        // Verificar se houve alteração de supervisor
                        if (workstation.supervisorId !== supervisorId) {
                            // Remover este posto do supervisor anterior (se houver)
                            if (workstation.supervisorId) {
                                const oldSupervisor = AppData.supervisors.find(s => s.id === workstation.supervisorId);
                                if (oldSupervisor && oldSupervisor.workstationIds) {
                                    oldSupervisor.workstationIds = oldSupervisor.workstationIds.filter(
                                        id => id !== workstation.id
                                    );
                                }
                            }
                            
                            // Associar ao novo supervisor
                            workstation.supervisorId = supervisorId;
                            const newSupervisor = AppData.supervisors.find(s => s.id === supervisorId);
                            if (newSupervisor) {
                                if (!newSupervisor.workstationIds) {
                                    newSupervisor.workstationIds = [];
                                }
                                if (!newSupervisor.workstationIds.includes(workstation.id)) {
                                    newSupervisor.workstationIds.push(workstation.id);
                                }
                            }
                        }
                        
                        showNotification('Posto de trabalho atualizado com sucesso', 'success');
                    }
                } else {
                    // Novo posto de trabalho
                    const newId = AppData.lastWorkstationId + 1;
                    const newWorkstation = {
                        id: newId,
                        name: name,
                        capacity: capacity,
                        warningThreshold: warningThreshold,
                        description: description,
                        supervisorId: supervisorId,
                        createdAt: now,
                        updatedAt: now
                    };
                    
                    AppData.workstations.push(newWorkstation);
                    AppData.lastWorkstationId = newId;
                    
                    // Associar ao supervisor
                    const supervisor = AppData.supervisors.find(s => s.id === supervisorId);
                    if (supervisor) {
                        if (!supervisor.workstationIds) {
                            supervisor.workstationIds = [];
                        }
                        supervisor.workstationIds.push(newId);
                    }
                    
                    showNotification('Posto de trabalho criado com sucesso', 'success');
                }
                
                // Atualizar UI
                updateUI();
                
                // Fechar modal
                hideWorkstationModal();
            } catch (error) {
                console.error('Erro ao salvar posto de trabalho:', error);
                showNotification('Ocorreu um erro ao salvar o posto de trabalho: ' + error.message, 'error');
            }
        }
        
        function editWorkstation(workstationId) {
            showWorkstationModal(workstationId);
        }
        
        function deleteWorkstation(workstationId) {
            try {
                // Verificar se o posto existe
                const workstation = AppData.workstations.find(w => w.id === workstationId);
                if (!workstation) {
                    showNotification('Posto de trabalho não encontrado', 'error');
                    return;
                }
                
                // Verificar se há funcionários alocados a este posto
                const hasEmployees = AppData.allocations.some(a => 
                    a.workstationId === workstationId && 
                    a.endDate === null
                );
                
                if (hasEmployees) {
                    showNotification('Não é possível excluir um posto de trabalho com funcionários alocados', 'warning');
                    return;
                }
                
                // Remover associação com o supervisor
                if (workstation.supervisorId) {
                    const supervisor = AppData.supervisors.find(s => s.id === workstation.supervisorId);
                    if (supervisor && supervisor.workstationIds) {
                        supervisor.workstationIds = supervisor.workstationIds.filter(
                            id => id !== workstationId
                        );
                    }
                }
                
                // Remover o posto de trabalho
                AppData.workstations = AppData.workstations.filter(w => w.id !== workstationId);
                
                showNotification('Posto de trabalho excluído com sucesso', 'success');
                
                // Atualizar UI
                updateUI();
            } catch (error) {
                console.error('Erro ao excluir posto de trabalho:', error);
                showNotification('Ocorreu um erro ao excluir o posto de trabalho: ' + error.message, 'error');
            }
        }
        
        // Funções para o modal de funcionários
        function showEmployeeModal(employeeId = null) {
            console.log("Abrindo modal de funcionário, ID:", employeeId);
            
            // Limpar o formulário
            document.getElementById('employee-form').reset();
            document.getElementById('employee-id').value = '';
            
            // Preencher o dropdown de postos de trabalho
            const workstationSelect = document.getElementById('employee-workstation');
            workstationSelect.innerHTML = '<option value="">Selecione um posto</option>';
            
            AppData.workstations.forEach(workstation => {
                // Verificar se o posto não está com a capacidade máxima
                const allocatedCount = AppData.allocations.filter(
                    a => a.workstationId === workstation.id && a.endDate === null
                ).length;
                
                // Só adicionar o posto se tiver capacidade (ou se estamos editando)
                if (allocatedCount < workstation.capacity || employeeId) {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = workstation.name;
                    
                    // Adicionar informação de ocupação
                    if (allocatedCount >= workstation.capacity) {
                        option.textContent += ' (Capacidade máxima)';
                        option.classList.add('text-danger');
                    } else {
                        option.textContent += ` (${allocatedCount}/${workstation.capacity})`;
                    }
                    
                    workstationSelect.appendChild(option);
                }
            });
            
            // Se for edição, preencher os campos com os dados do funcionário
            if (employeeId) {
                const employee = AppData.employees.find(e => e.id === employeeId);
                if (employee) {
                    document.getElementById('employee-modal-title').textContent = 'Editar Funcionário';
                    document.getElementById('employee-id').value = employee.id;
                    document.getElementById('employee-name').value = employee.name;
                    document.getElementById('employee-id-code').value = employee.idCode;
                    document.getElementById('employee-birth-date').value = employee.birthDate;
                    document.getElementById('employee-position').value = employee.position;
                    document.getElementById('employee-status').value = employee.status;
                    document.getElementById('employee-notes').value = employee.notes || '';
                    
                    // Obter posto atual
                    const currentAllocation = AppData.allocations.find(
                        a => a.employeeId === employeeId && a.endDate === null
                    );
                    
                    if (currentAllocation) {
                        workstationSelect.value = currentAllocation.workstationId;
                    }
                }
            } else {
                document.getElementById('employee-modal-title').textContent = 'Novo Funcionário';
            }
            
            // Mostrar o modal
            document.getElementById('employee-modal').classList.remove('hidden');
        }
        
        function hideEmployeeModal() {
            document.getElementById('employee-modal').classList.add('hidden');
        }
        
        function saveEmployee(event) {
            event.preventDefault();
            
            try {
                const employeeId = document.getElementById('employee-id').value;
                const name = document.getElementById('employee-name').value;
                const idCode = document.getElementById('employee-id-code').value;
                const birthDate = document.getElementById('employee-birth-date').value;
                const hireDate = document.getElementById('employee-hire-date').value;
                const position = document.getElementById('employee-position').value;
                const status = document.getElementById('employee-status').value;
                const workstationId = document.getElementById('employee-workstation').value;
                const notes = document.getElementById('employee-notes').value;
                
                if (!name || !idCode || !birthDate || !hireDate || !position || !status || !workstationId) {
                    showNotification('Por favor, preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                const now = new Date().toISOString();
                
                if (employeeId) {
                    // Edição de funcionário existente
                    const index = AppData.employees.findIndex(e => e.id === parseInt(employeeId));
                    if (index !== -1) {
                        const employee = AppData.employees[index];
                        
                        // Atualizar dados do funcionário
                        employee.name = name;
                        employee.idCode = idCode;
                        employee.birthDate = birthDate;
                        employee.hireDate = hireDate;
                        employee.position = position;
                        employee.status = status;
                        employee.notes = notes;
                        employee.updatedAt = now;
                        
                        // Verificar se houve alteração de posto
                        const currentAllocation = AppData.allocations.find(
                            a => a.employeeId === parseInt(employeeId) && a.endDate === null
                        );
                        
                        if (currentAllocation && currentAllocation.workstationId !== parseInt(workstationId)) {
                            // Encerrar alocação atual
                            currentAllocation.endDate = now;
                            
                            // Criar nova alocação
                            const newAllocationId = AppData.lastAllocationId + 1;
                            const newAllocation = {
                                id: newAllocationId,
                                employeeId: parseInt(employeeId),
                                workstationId: parseInt(workstationId),
                                startDate: now,
                                endDate: null,
                                notes: "Transferência via edição de funcionário"
                            };
                            
                            AppData.allocations.push(newAllocation);
                            AppData.lastAllocationId = newAllocationId;
                        } else if (!currentAllocation) {
                            // Funcionário não tinha alocação, criar uma nova
                            const newAllocationId = AppData.lastAllocationId + 1;
                            const newAllocation = {
                                id: newAllocationId,
                                employeeId: parseInt(employeeId),
                                workstationId: parseInt(workstationId),
                                startDate: now,
                                endDate: null,
                                notes: "Alocação inicial"
                            };
                            
                            AppData.allocations.push(newAllocation);
                            AppData.lastAllocationId = newAllocationId;
                        }
                        
                        showNotification('Funcionário atualizado com sucesso', 'success');
                    }
                } else {
                    // Novo funcionário
                    const newId = AppData.lastEmployeeId + 1;
                    const newEmployee = {
                        id: newId,
                        name: name,
                        idCode: idCode,
                        birthDate: birthDate,
                        hireDate: hireDate,
                        position: position,
                        status: status,
                        notes: notes,
                        createdAt: now,
                        updatedAt: now
                    };
                    
                    AppData.employees.push(newEmployee);
                    AppData.lastEmployeeId = newId;
                    
                    // Criar alocação inicial
                    const newAllocationId = AppData.lastAllocationId + 1;
                    const newAllocation = {
                        id: newAllocationId,
                        employeeId: newId,
                        workstationId: parseInt(workstationId),
                        startDate: now,
                        endDate: null,
                        notes: "Alocação inicial"
                    };
                    
                    AppData.allocations.push(newAllocation);
                    AppData.lastAllocationId = newAllocationId;
                    
                    showNotification('Funcionário criado com sucesso', 'success');
                }
                
                // Atualizar UI
                updateUI();
                
                // Fechar modal
                hideEmployeeModal();
            } catch (error) {
                console.error('Erro ao salvar funcionário:', error);
                showNotification('Ocorreu um erro ao salvar o funcionário: ' + error.message, 'error');
            }
        }
        
        function editEmployee(employeeId) {
            showEmployeeModal(employeeId);
        }
        
        function deleteEmployee(employeeId) {
            try {
                // Verificar se o funcionário existe
                const employee = AppData.employees.find(e => e.id === employeeId);
                if (!employee) {
                    showNotification('Funcionário não encontrado', 'error');
                    return;
                }
                
                // Encerrar alocações ativas
                AppData.allocations.forEach(allocation => {
                    if (allocation.employeeId === employeeId && allocation.endDate === null) {
                        allocation.endDate = new Date().toISOString();
                        allocation.notes = (allocation.notes || "") + " | Encerrado por exclusão do funcionário";
                    }
                });
                
                // Remover o funcionário
                AppData.employees = AppData.employees.filter(e => e.id !== employeeId);
                
                showNotification('Funcionário excluído com sucesso', 'success');
                
                // Atualizar UI
                updateUI();
            } catch (error) {
                console.error('Erro ao excluir funcionário:', error);
                showNotification('Ocorreu um erro ao excluir o funcionário: ' + error.message, 'error');
            }
        }
        
        // Funções para transferência de funcionários
        function showEmployeeSelectionModal() {
            console.log("Abrindo modal de seleção de funcionário para transferência");
            
            // Verificar se há funcionários para transferir
            if (AppData.employees.length === 0) {
                showNotification('É necessário cadastrar funcionários antes de registrar transferências', 'warning');
                return;
            }
            
            // Limpar e preencher a lista de funcionários
            const employeeList = document.getElementById('employee-selection-list');
            employeeList.innerHTML = '';
            
            // Filtrar funcionários ativos
            const activeEmployees = AppData.employees.filter(e => e.status === 'Ativo');
            
            if (activeEmployees.length === 0) {
                employeeList.innerHTML = `
                    <li class="p-4 text-center text-gray-500 dark:text-gray-400">
                        Nenhum funcionário ativo encontrado
                    </li>
                `;
                
                // Mostrar o modal mesmo sem funcionários
                document.getElementById('employee-selection-modal').classList.remove('hidden');
                return;
            }
            
            // Preencher a lista com funcionários ativos
            activeEmployees.forEach(employee => {
                const workstation = getCurrentWorkstation(employee.id);
                const workstationName = workstation ? workstation.name : 'Não alocado';
                
                const li = document.createElement('li');
                li.className = 'p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                li.onclick = () => selectEmployeeForTransfer(employee.id);
                li.innerHTML = `
                    <div class="flex justify-between">
                        <div>
                            <div class="font-medium">${employee.name}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${employee.idCode} - ${employee.position}</div>
                        </div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">${workstationName}</div>
                    </div>
                `;
                
                employeeList.appendChild(li);
            });
            
            // Configurar campo de pesquisa
            const searchInput = document.getElementById('employee-search-transfer');
            if (searchInput) {
                // Limpar valor anterior
                searchInput.value = '';
                
                // Adicionar evento de busca
                searchInput.oninput = filterEmployeeSelectionList;
            }
            
            // Mostrar o modal
            document.getElementById('employee-selection-modal').classList.remove('hidden');
        }
        
        function hideEmployeeSelectionModal() {
            document.getElementById('employee-selection-modal').classList.add('hidden');
        }
        
        function filterEmployeeSelectionList() {
            const searchTerm = document.getElementById('employee-search-transfer').value.toLowerCase();
            const items = document.querySelectorAll('#employee-selection-list li');
            
            items.forEach(item => {
                if (item.textContent.toLowerCase().includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function selectEmployeeForTransfer(employeeId) {
            // Fechar o modal de seleção
            hideEmployeeSelectionModal();
            
            // Abrir o modal de transferência com os dados deste funcionário
            showTransferModal(employeeId);
        }
        
        function showTransferModal(employeeId) {
            console.log("Abrindo modal de transferência para funcionário ID:", employeeId);
            
            // Verificar se o funcionário existe
            const employee = AppData.employees.find(e => e.id === employeeId);
            if (!employee) {
                showNotification('Funcionário não encontrado', 'error');
                return;
            }
            
            // Obter posto atual
            const currentWorkstation = getCurrentWorkstation(employeeId);
            if (!currentWorkstation) {
                showNotification('Este funcionário não está alocado a nenhum posto de trabalho', 'warning');
                return;
            }
            
            // Obter alocação atual
            const currentAllocation = AppData.allocations.find(a => 
                a.employeeId === employeeId && a.endDate === null
            );
            
            // Preencher dados do funcionário no modal
            document.getElementById('transfer-employee-id').value = employeeId;
            document.getElementById('transfer-employee-name').textContent = `${employee.name} (${employee.idCode})`;
            document.getElementById('transfer-current-workstation').textContent = currentWorkstation.name;
            
            // Obter a data da alocação atual para usar como referência mínima
            const currentAllocationDate = new Date(currentAllocation.startDate || new Date());
            
            // Definir data padrão como a data atual, mas permitir que o usuário selecione qualquer data
            const today = new Date();
            document.getElementById('transfer-date').value = today.toISOString().split('T')[0];
            
            // Remover qualquer restrição de data mínima para permitir selecionar datas passadas
            document.getElementById('transfer-date').removeAttribute('min');
            
            // Verificar se os elementos existem antes de manipulá-los
            const dateLabel = document.querySelector('label[for="transfer-date"]');
            const transferDateInput = document.getElementById('transfer-date');
            
            if (dateLabel && dateLabel.parentNode) {
                const dateContainer = dateLabel.parentNode;
                const dateHelp = document.createElement('div');
                dateHelp.className = "text-sm text-gray-500 dark:text-gray-400 mt-1";
                dateHelp.innerHTML = `<i class="fas fa-info-circle mr-1"></i> A data mínima permitida é ${formatDate(currentAllocationDate)}`;
                
                // Remover qualquer nota anterior se existir
                const existingHelp = dateContainer.querySelector('.text-sm');
                if (existingHelp) existingHelp.remove();
                
                // Adicionar a nova nota
                dateContainer.appendChild(dateHelp);
            }
            
            // Mostrar a data da alocação atual como informação para o usuário
            if (transferDateInput) {
                const allocationDate = currentAllocationDate.toLocaleDateString('pt-BR');
                const dateInfo = document.createElement('div');
                dateInfo.className = "text-sm text-gray-500 dark:text-gray-400 mt-1";
                dateInfo.innerHTML = `<i class="fas fa-info-circle mr-1"></i> Data da alocação atual: ${allocationDate}`;
                transferDateInput.insertAdjacentElement('afterend', dateInfo);
            }
            
            // Preencher dropdown de supervisores
            const supervisorSelect = document.getElementById('transfer-supervisor');
            supervisorSelect.innerHTML = '<option value="">Selecione o supervisor</option>';
            
            AppData.supervisors.forEach(supervisor => {
                const option = document.createElement('option');
                option.value = supervisor.id;
                option.textContent = supervisor.name;
                supervisorSelect.appendChild(option);
            });
            
            // Configurar o evento de mudança do supervisor para filtrar os postos
            supervisorSelect.onchange = function() {
                updateTransferWorkstationOptions(currentWorkstation.id);
            };
            
            // Limpar o dropdown de postos até que um supervisor seja selecionado
            const workstationSelect = document.getElementById('transfer-new-workstation');
            workstationSelect.innerHTML = '<option value="">Selecione primeiro um supervisor</option>';
            workstationSelect.disabled = true;
            
            // Limpar observações
            document.getElementById('transfer-notes').value = '';
            
            // Mostrar o modal
            document.getElementById('transfer-modal').classList.remove('hidden');
        }
        
        // Função para atualizar as opções de postos de trabalho com base no supervisor selecionado
        function updateTransferWorkstationOptions(currentWorkstationId) {
            const supervisorSelect = document.getElementById('transfer-supervisor');
            const workstationSelect = document.getElementById('transfer-new-workstation');
            const supervisorId = parseInt(supervisorSelect.value);
            
            // Redefinir o dropdown de postos
            workstationSelect.innerHTML = '<option value="">Selecione o novo posto</option>';
            
            // Habilitar/desabilitar o dropdown de postos dependendo se um supervisor foi selecionado
            if (!supervisorId) {
                workstationSelect.disabled = true;
                return;
            }
            
            workstationSelect.disabled = false;
            
            // Filtrar os postos pelo supervisor selecionado
            const supervisorWorkstations = AppData.workstations.filter(workstation => 
                workstation.supervisorId === supervisorId
            );
            
            // Adicionar postos filtrados ao dropdown
            supervisorWorkstations.forEach(workstation => {
                // Pular o posto atual
                if (workstation.id === currentWorkstationId) return;
                
                // Verificar ocupação
                const allocatedCount = AppData.allocations.filter(
                    a => a.workstationId === workstation.id && a.endDate === null
                ).length;
                
                // Só adicionar o posto se tiver capacidade
                if (allocatedCount < workstation.capacity) {
                    const option = document.createElement('option');
                    option.value = workstation.id;
                    option.textContent = `${workstation.name} (${allocatedCount}/${workstation.capacity})`;
                    workstationSelect.appendChild(option);
                }
            });
            
            // Se não houver postos disponíveis, mostrar mensagem informativa
            if (workstationSelect.options.length <= 1) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "Nenhum posto disponível para este supervisor";
                workstationSelect.appendChild(option);
            }
        }
        
        function hideTransferModal() {
            document.getElementById('transfer-modal').classList.add('hidden');
        }
        
        function saveTransfer(event) {
            event.preventDefault();
            
            try {
                const employeeId = parseInt(document.getElementById('transfer-employee-id').value);
                const newWorkstationId = parseInt(document.getElementById('transfer-new-workstation').value);
                const transferDate = document.getElementById('transfer-date').value;
                const notes = document.getElementById('transfer-notes').value;
                
                if (!employeeId || !newWorkstationId || !transferDate) {
                    showNotification('Por favor, preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                // Verificar se o funcionário existe
                const employee = AppData.employees.find(e => e.id === employeeId);
                if (!employee) {
                    showNotification('Funcionário não encontrado', 'error');
                    return;
                }
                
                // Verificar se o posto existe
                const newWorkstation = AppData.workstations.find(w => w.id === newWorkstationId);
                if (!newWorkstation) {
                    showNotification('Posto de trabalho não encontrado', 'error');
                    return;
                }
                
                // Verificar capacidade do novo posto
                const allocatedCount = AppData.allocations.filter(
                    a => a.workstationId === newWorkstationId && a.endDate === null
                ).length;
                
                if (allocatedCount >= newWorkstation.capacity) {
                    showNotification('O posto de destino já está com capacidade máxima', 'warning');
                    return;
                }
                
                // Obter alocação atual
                const currentAllocation = AppData.allocations.find(
                    a => a.employeeId === employeeId && a.endDate === null
                );
                
                if (!currentAllocation) {
                    showNotification('Não foi encontrada uma alocação ativa para este funcionário', 'error');
                    return;
                }
                
                // A data de transferência pode ser qualquer data (anterior ou posterior)
                const transferDateObj = new Date(transferDate);
                transferDateObj.setHours(0, 0, 0, 0);
                
                // Removida a validação de data anterior - permitimos qualquer data para transferência
                
                // Encerrar alocação atual na data de transferência
                currentAllocation.endDate = new Date(transferDate + 'T00:00:00.000Z').toISOString();
                
                // Criar nova alocação a partir da data de transferência
                const newAllocationId = AppData.lastAllocationId + 1;
                const newAllocation = {
                    id: newAllocationId,
                    employeeId: employeeId,
                    workstationId: newWorkstationId,
                    startDate: new Date(transferDate + 'T00:00:00.000Z').toISOString(),
                    endDate: null,
                    notes: notes || "Transferência de posto"
                };
                
                AppData.allocations.push(newAllocation);
                AppData.lastAllocationId = newAllocationId;
                
                showNotification('Transferência registrada com sucesso', 'success');
                
                // Atualizar UI
                updateUI();
                
                // Fechar modal
                hideTransferModal();
                
                // Ir para a seção de transferências
                showSection('allocation-history-section');
            } catch (error) {
                console.error('Erro ao registrar transferência:', error);
                showNotification('Ocorreu um erro ao registrar a transferência: ' + error.message, 'error');
            }
        }
        
        // Funções para relatório mensal
        function generateMonthlyReport() {
            try {
                const monthYearStr = document.getElementById('monthly-report-month').value;
                const workstationFilter = document.getElementById('monthly-report-workstation').value;
                
                if (!monthYearStr) {
                    showNotification('Por favor, selecione um mês/ano para o relatório', 'warning');
                    return;
                }
                
                // Extrair ano e mês
                const [year, month] = monthYearStr.split('-').map(Number);
                const reportStartDate = new Date(year, month - 1, 1); // Primeiro dia do mês
                const reportEndDate = new Date(year, month, 0); // Último dia do mês
                
                // Ajustar o final do dia
                reportEndDate.setHours(23, 59, 59, 999);
                
                // Formatar título do relatório
                const monthNames = [
                    'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ];
                
                const reportTitle = document.getElementById('monthly-report-title');
                reportTitle.textContent = `Relatório de Alocações - ${monthNames[month - 1]}/${year}`;
                
                // Obter dados relevantes para o relatório
                const reportData = {
                    allocations: [],
                    employees: {},
                    workstations: {},
                    transfers: []
                };
                
                // Encontrar todas as alocações relevantes para o período
                AppData.allocations.forEach(allocation => {
                    const startDate = new Date(allocation.startDate);
                    const endDate = allocation.endDate ? new Date(allocation.endDate) : new Date();
                    
                    // Verificar se a alocação estava ativa em algum momento do mês
                    if ((startDate <= reportEndDate) && (endDate >= reportStartDate)) {
                        // Se houver filtro de posto, verificar
                        if (workstationFilter && allocation.workstationId !== parseInt(workstationFilter)) {
                            return; // Pular esta alocação
                        }
                        
                        const employee = AppData.employees.find(e => e.id === allocation.employeeId);
                        const workstation = AppData.workstations.find(w => w.id === allocation.workstationId);
                        
                        if (employee && workstation) {
                            reportData.allocations.push({
                                ...allocation,
                                employeeName: employee.name,
                                employeeCode: employee.idCode,
                                workstationName: workstation.name
                            });
                            
                            // Registrar funcionário e posto para resumos
                            reportData.employees[employee.id] = employee;
                            reportData.workstations[workstation.id] = workstation;
                        }
                    }
                });
                
                // Encontrar transferências que ocorreram no mês
                reportData.allocations.forEach(allocation => {
                    // Se a alocação iniciou durante o mês do relatório, é uma transferência
                    const startDate = new Date(allocation.startDate);
                    if (startDate >= reportStartDate && startDate <= reportEndDate) {
                        // Encontrar a alocação anterior (se houver)
                        const previousAllocation = AppData.allocations.find(a => 
                            a.employeeId === allocation.employeeId && 
                            a.endDate === allocation.startDate
                        );
                        
                        if (previousAllocation) {
                            const fromWorkstation = AppData.workstations.find(w => w.id === previousAllocation.workstationId);
                            
                            reportData.transfers.push({
                                date: startDate,
                                employeeId: allocation.employeeId,
                                employeeName: allocation.employeeName,
                                employeeCode: allocation.employeeCode,
                                fromWorkstationId: previousAllocation.workstationId,
                                fromWorkstationName: fromWorkstation ? fromWorkstation.name : 'Desconhecido',
                                toWorkstationId: allocation.workstationId,
                                toWorkstationName: allocation.workstationName,
                                notes: allocation.notes
                            });
                        } else {
                            // Se não há alocação anterior, é uma entrada no sistema
                            reportData.transfers.push({
                                date: startDate,
                                employeeId: allocation.employeeId,
                                employeeName: allocation.employeeName,
                                employeeCode: allocation.employeeCode,
                                fromWorkstationId: null,
                                fromWorkstationName: 'Entrada no sistema',
                                toWorkstationId: allocation.workstationId,
                                toWorkstationName: allocation.workstationName,
                                notes: allocation.notes
                            });
                        }
                    }
                    
                    // Se a alocação terminou durante o mês do relatório
                    if (allocation.endDate) {
                        const endDate = new Date(allocation.endDate);
                        if (endDate >= reportStartDate && endDate <= reportEndDate) {
                            // Verificar se não há alocação seguinte ou se ela é depois do fim do mês
                            const nextAllocation = AppData.allocations.find(a => 
                                a.employeeId === allocation.employeeId && 
                                a.startDate === allocation.endDate
                            );
                            
                            if (!nextAllocation) {
                                reportData.transfers.push({
                                    date: endDate,
                                    employeeId: allocation.employeeId,
                                    employeeName: allocation.employeeName,
                                    employeeCode: allocation.employeeCode,
                                    fromWorkstationId: allocation.workstationId,
                                    fromWorkstationName: allocation.workstationName,
                                    toWorkstationId: null,
                                    toWorkstationName: 'Saída do sistema',
                                    notes: allocation.notes
                                });
                            }
                        }
                    }
                });
                
                // Ordenar transferências por data
                reportData.transfers.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Gerar o relatório na UI
                const reportContainer = document.getElementById('monthly-report-container');
                const reportContent = document.getElementById('monthly-report-content');
                
                // Limpar conteúdo anterior
                reportContent.innerHTML = '';
                
                // Verificar se existem dados para mostrar
                if (reportData.allocations.length === 0) {
                    reportContent.innerHTML = `
                        <div class="p-4 text-center text-gray-500 dark:text-gray-400">
                            Não há dados de alocação para o período selecionado.
                        </div>
                    `;
                    
                    // Mostrar o container do relatório
                    reportContainer.classList.remove('hidden');
                    return;
                }
                
                // Resumo do período
                reportContent.innerHTML += `
                    <div class="mb-4">
                        <h4 class="font-medium mb-2">Resumo do Período</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                                <span class="text-sm text-gray-500 dark:text-gray-400">Funcionários</span>
                                <p class="text-xl font-bold">${Object.keys(reportData.employees).length}</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                                <span class="text-sm text-gray-500 dark:text-gray-400">Postos de Trabalho</span>
                                <p class="text-xl font-bold">${Object.keys(reportData.workstations).length}</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                                <span class="text-sm text-gray-500 dark:text-gray-400">Transferências</span>
                                <p class="text-xl font-bold">${reportData.transfers.length}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Lista de transferências no período
                if (reportData.transfers.length > 0) {
                    reportContent.innerHTML += `
                        <div class="mb-4">
                            <h4 class="font-medium mb-2">Transferências no Período</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Funcionário</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Origem</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Destino</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                        ${reportData.transfers.map(transfer => `
                                            <tr>
                                                <td class="px-3 py-2 whitespace-nowrap">${formatDate(transfer.date)}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${transfer.employeeName}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${transfer.fromWorkstationName}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${transfer.toWorkstationName}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
                
                // Distribuição de funcionários por posto (snapshot do fim do mês)
                reportContent.innerHTML += `
                    <div>
                        <h4 class="font-medium mb-2">Distribuição de Funcionários por Posto</h4>
                    </div>
                `;
                
                // Mostrar o container do relatório
                reportContainer.classList.remove('hidden');
            } catch (error) {
                console.error('Erro ao gerar relatório mensal:', error);
                showNotification('Ocorreu um erro ao gerar o relatório: ' + error.message, 'error');
            }
        }
        
        function exportMonthlyReport() {
            try {
                const monthYearStr = document.getElementById('monthly-report-month').value;
                
                if (!monthYearStr) {
                    showNotification('Por favor, gere um relatório antes de exportar', 'warning');
                    return;
                }
                
                // Extrair mês e ano para o nome do arquivo
                const [year, month] = monthYearStr.split('-');
                const fileName = `relatorio_alocacoes_${month}_${year}.csv`;
                
                // Obter conteúdo HTML do relatório
                const reportContent = document.getElementById('monthly-report-content');
                
                // Obter tabela de transferências
                const transferTable = reportContent.querySelector('table');
                if (!transferTable) {
                    showNotification('Não há dados de transferências para exportar', 'warning');
                    return;
                }
                
                // Construir CSV
                let csvContent = 'Data,Funcionário,Origem,Destino\n';
                
                // Pular o header da tabela e obter as linhas de dados
                const rows = Array.from(transferTable.querySelectorAll('tbody tr'));
                rows.forEach(row => {
                    const cells = Array.from(row.querySelectorAll('td'));
                    const rowData = cells.map(cell => `"${cell.textContent.trim()}"`);
                    csvContent += rowData.join(',') + '\n';
                });
                
                // Criar blob e link para download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Relatório exportado com sucesso', 'success');
            } catch (error) {
                console.error('Erro ao exportar relatório:', error);
                showNotification('Ocorreu um erro ao exportar o relatório: ' + error.message, 'error');
            }
        }
        
        // Função para atualizar a lista de postos de trabalho
        function updateWorkstationsList() {
            // Obter elementos do DOM
            const workstationsGrid = document.getElementById('workstations-grid');
            const workstationsTableBody = document.getElementById('workstations-table-body');
            
            if (!workstationsGrid || !workstationsTableBody) return;
            
            // Obter filtros
            const searchTerm = document.getElementById('workstation-search')?.value?.toLowerCase() || '';
            const supervisorFilter = document.getElementById('workstation-supervisor-filter')?.value || '';
            const capacityFilter = document.getElementById('workstation-capacity-filter')?.value || '';
            
            // Filtrar postos
            let filteredWorkstations = [...AppData.workstations];
            
            if (searchTerm) {
                filteredWorkstations = filteredWorkstations.filter(workstation => 
                    workstation.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (supervisorFilter) {
                filteredWorkstations = filteredWorkstations.filter(workstation => 
                    workstation.supervisorId && workstation.supervisorId.toString() === supervisorFilter
                );
            }
            
            if (capacityFilter) {
                switch (capacityFilter) {
                    case 'low':
                        filteredWorkstations = filteredWorkstations.filter(w => w.capacity <= 5);
                        break;
                    case 'medium':
                        filteredWorkstations = filteredWorkstations.filter(w => w.capacity > 5 && w.capacity <= 15);
                        break;
                    case 'high':
                        filteredWorkstations = filteredWorkstations.filter(w => w.capacity > 15);
                        break;
                }
            }
            
            // Limpar grid e tabela
            workstationsGrid.innerHTML = '';
            workstationsTableBody.innerHTML = '';
            
            // Exibir mensagem se não houver resultados
            if (filteredWorkstations.length === 0) {
                workstationsGrid.innerHTML = `
                    <div class="col-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center">
                        <p class="text-gray-500 dark:text-gray-400 mb-4">
                            ${searchTerm || supervisorFilter || capacityFilter ? 'Nenhum posto encontrado com os filtros aplicados' : 'Nenhum posto de trabalho cadastrado'}
                        </p>
                        ${!searchTerm && !supervisorFilter && !capacityFilter ? `
                            <button id="add-first-workstation" class="px-4 py-2 bg-primary hover:bg-secondary text-white rounded-md">
                                <i class="fas fa-plus-circle mr-1"></i>Adicionar Posto
                            </button>
                        ` : ''}
                    </div>
                `;
                
                workstationsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            ${searchTerm || supervisorFilter || capacityFilter ? 'Nenhum posto encontrado com os filtros aplicados' : 'Nenhum posto de trabalho cadastrado'}
                        </td>
                    </tr>
                `;
                
                // Adicionar evento ao botão de adicionar
                const addFirstBtn = document.getElementById('add-first-workstation');
                if (addFirstBtn) {
                    addFirstBtn.addEventListener('click', showWorkstationModal);
                }
                
                return;
            }
            
            // Atualizar grid de cards
            filteredWorkstations.forEach(workstation => {
                // Encontrar supervisor
                const supervisor = AppData.supervisors.find(s => s.id === workstation.supervisorId);
                const supervisorName = supervisor ? supervisor.name : 'Não atribuído';
                
                // Contar funcionários alocados
                const allocatedEmployees = AppData.allocations.filter(a => 
                    a.workstationId === workstation.id && 
                    a.endDate === null
                ).length;
                
                // Calcular taxa de ocupação
                const occupancyRate = workstation.capacity > 0 
                    ? (allocatedEmployees / workstation.capacity) * 100 
                    : 0;
                
                // Determinar status com base no limite de alerta
                let statusClass, statusText, bgClass;
                if (occupancyRate >= workstation.warningThreshold) {
                    statusClass = 'text-warning';
                    statusText = 'Próximo do limite';
                    bgClass = 'bg-yellow-100 dark:bg-yellow-900/30';
                    if (occupancyRate >= 100) {
                        statusClass = 'text-danger';
                        statusText = 'Capacidade máxima';
                        bgClass = 'bg-red-100 dark:bg-red-900/30';
                    }
                } else {
                    statusClass = 'text-success';
                    statusText = 'Disponível';
                    bgClass = 'bg-green-100 dark:bg-green-900/30';
                }
                
                // Criar card
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden';
                card.innerHTML = `
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-medium text-lg">${workstation.name}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Supervisor: ${supervisorName}</p>
                            </div>
                            <span class="${statusClass} text-xs px-2 py-1 rounded-full ${bgClass}">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-sm text-gray-500 dark:text-gray-400">Ocupação:</span>
                            <span class="text-sm font-medium">${allocatedEmployees} / ${workstation.capacity}</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-4">
                            <div class="h-2.5 rounded-full ${statusClass === 'text-danger' ? 'bg-danger' : 
                                        statusClass === 'text-warning' ? 'bg-warning' : 'bg-success'}" 
                                 style="width: ${Math.min(100, occupancyRate)}%">
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2 h-10 mb-2">
                            ${workstation.description || 'Sem descrição'}
                        </p>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 flex justify-between">
                        <div>
                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                Alerta: ${workstation.warningThreshold}%
                            </span>
                        </div>
                        <div>
                            <button class="text-primary hover:text-secondary mr-2" onclick="editWorkstation(${workstation.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-danger hover:text-red-700" onclick="deleteWorkstation(${workstation.id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                workstationsGrid.appendChild(card);
                
                // Criar linha para a tabela
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${workstation.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${supervisorName}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-center">${workstation.capacity}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-center">${allocatedEmployees} / ${workstation.capacity}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="${statusClass}">
                            <i class="fas fa-circle mr-1 text-xs"></i>
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <button class="text-primary hover:text-secondary mr-2" onclick="editWorkstation(${workstation.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-danger hover:text-red-700" onclick="deleteWorkstation(${workstation.id})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                workstationsTableBody.appendChild(row);
            });
        }
        
        // Alternar entre visualização de cards e lista
        function toggleWorkstationView(view) {
            const gridBtn = document.getElementById('btn-grid-view');
            const listBtn = document.getElementById('btn-list-view');
            const workstationsGrid = document.getElementById('workstations-grid');
            const workstationsListContainer = document.getElementById('workstations-list-container');
            
            if (view === 'grid') {
                // Mostrar grid, esconder lista
                workstationsGrid.classList.remove('hidden');
                workstationsListContainer.classList.add('hidden');
                
                // Atualizar botões
                gridBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                gridBtn.classList.add('bg-primary', 'text-white');
                
                listBtn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                listBtn.classList.remove('bg-primary', 'text-white');
            } else {
                // Mostrar lista, esconder grid
                workstationsGrid.classList.add('hidden');
                workstationsListContainer.classList.remove('hidden');
                
                // Atualizar botões
                gridBtn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                gridBtn.classList.remove('bg-primary', 'text-white');
                
                listBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                listBtn.classList.add('bg-primary', 'text-white');
            }
        }
        
        // Atualizar filtro de supervisores na seção de postos
        function updateWorkstationFilters() {
            const supervisorFilter = document.getElementById('workstation-supervisor-filter');
            if (supervisorFilter) {
                const currentValue = supervisorFilter.value;
                supervisorFilter.innerHTML = '<option value="">Todos os supervisores</option>';
                
                AppData.supervisors.forEach(supervisor => {
                    const option = document.createElement('option');
                    option.value = supervisor.id;
                    option.textContent = supervisor.name;
                    supervisorFilter.appendChild(option);
                });
                
                if (currentValue) {
                    supervisorFilter.value = currentValue;
                }
            }
        }
        
        // Função para gerenciar arquivos selecionados
        function handleFileSelection(fileInput, displayElement, infoElement) {
            fileInput.addEventListener('change', function(e) {
                const fileList = e.target.files;
                if (fileList.length > 0) {
                    const file = fileList[0];
                    // Mostrar nome do arquivo
                    displayElement.textContent = file.name;
                    
                    // Mostrar informações do arquivo
                    if (infoElement) {
                        const fileSize = (file.size / 1024).toFixed(2) + ' KB';
                        infoElement.textContent = `Tamanho: ${fileSize} | Tipo: ${file.type}`;
                        infoElement.classList.remove('hidden');
                    }
                } else {
                    // Sem arquivo selecionado
                    displayElement.textContent = 'Nenhum arquivo escolhido';
                    if (infoElement) {
                        infoElement.classList.add('hidden');
                    }
                }
            });
        }
        
        // Função para gerar e baixar templates CSV
        function downloadTemplate(type) {
            console.log(`Gerando template para: ${type}`);
            let csvContent = '';
            let fileName = '';
            
            switch (type) {
                case 'supervisors':
                    csvContent = 'Nome,Código/Matrícula\nSupervisor Exemplo,SUP-001\nJosé da Silva,SUP-002';
                    fileName = 'modelo_supervisores.csv';
                    break;
                    
                case 'workstations':
                    csvContent = 'Nome,Capacidade,LimiteAlerta,SupervisorID,Descrição\nPosto A,10,80,1,Descrição do posto A\nPosto B,5,70,1,Descrição do posto B';
                    fileName = 'modelo_postos.csv';
                    break;
                    
                case 'employees':
                    csvContent = 'Nome,Matrícula,DataNascimento,DataAdmissão,Cargo,Status,PostoID,Observações\nJoão Silva,EMP-001,1990-01-01,2022-01-10,Analista,Ativo,1,Observações\nMaria Souza,EMP-002,1985-05-15,2021-06-20,Técnico,Ativo,1,Observações';
                    fileName = 'modelo_funcionarios.csv';
                    break;
                    
                case 'allocations':
                    csvContent = 'FuncionarioID,PostoOrigemID,PostoDestinoID,DataTransferencia,Observações\n1,,1,2022-01-10,Alocação inicial\n2,1,2,2022-03-15,Transferência para novo posto';
                    fileName = 'modelo_transferencias.csv';
                    break;
                    
                default:
                    showNotification('Tipo de modelo não reconhecido', 'error');
                    return;
            }
            
            // Criar e baixar o arquivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`Modelo de ${getTypeName(type)} baixado com sucesso`, 'success');
        }
        
        // Função para exportar dados
        function exportData(type) {
            console.log(`Exportando dados do tipo: ${type}`);
            let csvContent = '';
            let fileName = '';
            let data = [];
            
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            
            switch (type) {
                case 'supervisors':
                    // Cabeçalho
                    csvContent = 'ID,Nome,Código/Matrícula,DataCriação,ÚltimaAtualização\n';
                    
                    // Dados
                    AppData.supervisors.forEach(supervisor => {
                        csvContent += `${supervisor.id},${supervisor.name},${supervisor.idCode},${formatCSVDate(supervisor.createdAt)},${formatCSVDate(supervisor.updatedAt)}\n`;
                    });
                    
                    fileName = `supervisores_${dateStr}.csv`;
                    break;
                    
                case 'workstations':
                    // Cabeçalho
                    csvContent = 'ID,Nome,Capacidade,LimiteAlerta,SupervisorID,Descrição,DataCriação,ÚltimaAtualização\n';
                    
                    // Dados
                    AppData.workstations.forEach(workstation => {
                        csvContent += `${workstation.id},${workstation.name},${workstation.capacity},${workstation.warningThreshold},${workstation.supervisorId || ''},${escapeCSV(workstation.description || '')},${formatCSVDate(workstation.createdAt)},${formatCSVDate(workstation.updatedAt)}\n`;
                    });
                    
                    fileName = `postos_${dateStr}.csv`;
                    break;
                    
                case 'employees':
                    // Cabeçalho
                    csvContent = 'ID,Nome,Matrícula,DataNascimento,DataAdmissão,Cargo,Status,PostoAtual,Observações,DataCriação,ÚltimaAtualização\n';
                    
                    // Dados
                    AppData.employees.forEach(employee => {
                        const currentWorkstation = getCurrentWorkstation(employee.id);
                        const workstationName = currentWorkstation ? currentWorkstation.name : 'Não alocado';
                        
                        csvContent += `${employee.id},${employee.name},${employee.idCode},${formatCSVDate(employee.birthDate)},${formatCSVDate(employee.hireDate)},${employee.position},${employee.status},${workstationName},${escapeCSV(employee.notes || '')},${formatCSVDate(employee.createdAt)},${formatCSVDate(employee.updatedAt)}\n`;
                    });
                    
                    fileName = `funcionarios_${dateStr}.csv`;
                    break;
                    
                case 'allocations':
                    // Cabeçalho
                    csvContent = 'ID,FuncionarioID,NomeFuncionario,PostoID,NomePosto,DataInício,DataFim,Observações\n';
                    
                    // Dados
                    AppData.allocations.forEach(allocation => {
                        const employee = AppData.employees.find(e => e.id === allocation.employeeId);
                        const workstation = AppData.workstations.find(w => w.id === allocation.workstationId);
                        
                        if (employee && workstation) {
                            csvContent += `${allocation.id},${allocation.employeeId},${employee.name},${allocation.workstationId},${workstation.name},${formatCSVDate(allocation.startDate)},${allocation.endDate ? formatCSVDate(allocation.endDate) : ''},${escapeCSV(allocation.notes || '')}\n`;
                        }
                    });
                    
                    fileName = `transferencias_${dateStr}.csv`;
                    break;
                    
                default:
                    showNotification('Tipo de exportação não reconhecido', 'error');
                    return;
            }
            
            // Criar e baixar o arquivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`Dados de ${getTypeName(type)} exportados com sucesso`, 'success');
        }
        
        // Função para exportar backup completo
        function exportFullBackup() {
            console.log("Exportando backup completo");
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const fileName = `backup_completo_${dateStr}.json`;
            
            // Preparar dados para o backup
            const backupData = { ...AppData };
            
            // Criar e baixar o arquivo
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Backup completo exportado com sucesso', 'success');
        }
        
        // Função auxiliar para formatar datas para CSV
        function formatCSVDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            } catch (error) {
                console.error("Erro ao formatar data para CSV:", error);
                return dateStr;
            }
        }
        
        // Função auxiliar para escapar strings em CSV
        function escapeCSV(text) {
            if (!text) return '';
            // Se o texto contém vírgulas, aspas ou quebras de linha, colocá-lo entre aspas duplas
            // E substituir aspas duplas dentro do texto por duas aspas duplas
            if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                return `"${text.replace(/"/g, '""')}"`;
            }
            return text;
        }
        
        // Função auxiliar para obter o nome amigável do tipo de dados
        function getTypeName(type) {
            switch (type) {
                case 'supervisors': return 'supervisores';
                case 'workstations': return 'postos de trabalho';
                case 'employees': return 'funcionários';
                case 'allocations': return 'transferências';
                default: return type;
            }
        }

        // Funções para importação de dados
        function processCSVImport(file, type) {
            if (!file) {
                showNotification('Por favor, selecione um arquivo CSV para importar.', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvContent = e.target.result;
                    // Aqui você pode implementar a lógica para processar o CSV com base no tipo
                    showNotification(`Arquivo CSV importado com sucesso: ${file.name}`, 'success');
                    
                    // Limpar seleção de arquivo após importação bem-sucedida
                    document.getElementById('import-file').value = '';
                    document.getElementById('file-name-display').textContent = 'Nenhum arquivo escolhido';
                    document.getElementById('selected-file-info').classList.add('hidden');
                    
                    // Atualizar UI após importação
                    updateUI();
                } catch (error) {
                    console.error('Erro ao processar arquivo CSV:', error);
                    showNotification('Erro ao processar o arquivo CSV: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Erro ao ler o arquivo CSV.', 'error');
            };
            
            reader.readAsText(file);
        }
        
        function processJSONBackup(file) {
            if (!file) {
                showNotification('Por favor, selecione um arquivo JSON para restaurar.', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    // Implementar lógica para restaurar dados do backup
                    showNotification('Backup restaurado com sucesso!', 'success');
                    
                    // Limpar seleção de arquivo após restauração bem-sucedida
                    document.getElementById('import-backup').value = '';
                    document.getElementById('backup-file-name-display').textContent = 'Nenhum arquivo escolhido';
                    document.getElementById('backup-file-info').classList.add('hidden');
                    
                    // Atualizar UI após restauração
                    updateUI();
                } catch (error) {
                    console.error('Erro ao processar arquivo de backup:', error);
                    showNotification('Erro ao processar o arquivo de backup: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Erro ao ler o arquivo de backup.', 'error');
            };
            
            reader.readAsText(file);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log("DOM carregado, iniciando configuração...");
                
                // Limpar qualquer estado anterior (garantir um início limpo)
                isUserLoggedIn = false;
                document.getElementById('login-screen')?.classList.remove('hidden');
                document.getElementById('app-container')?.classList.add('hidden');
                
                // Atualizar UI com os dados iniciais
                updateUI();
                
                // Adicionar um botão de login alternativo para caso o formulário não esteja funcionando
                const loginBtn = document.createElement('button');
                loginBtn.textContent = "Login Alternativo (admin/admin123)";
                loginBtn.className = "w-full mt-4 py-2 px-4 bg-gray-500 hover:bg-gray-600 text-white rounded-md";
                loginBtn.type = "button"; // Importante: tipo button para não submeter o formulário
                loginBtn.addEventListener('click', function() {
                    console.log("Botão de login alternativo clicado");
                    login();
                });
                
                // Adicionar o botão após o formulário de login
                const loginSection = document.querySelector('#login-screen .w-full.max-w-md');
                if (loginSection) {
                    const credentialsSection = loginSection.querySelector('.mt-6');
                    if (credentialsSection) {
                        credentialsSection.appendChild(loginBtn);
                    }
                }
                
                // Configurar formulário de login
                const loginForm = document.getElementById('login-form');
                console.log("Formulário de login encontrado:", !!loginForm);
                
                if (loginForm) {
                    // Usar múltiplas abordagens para garantir que o evento seja capturado
                    const handleSubmit = function(e) {
                        if (e) e.preventDefault();
                        console.log("Formulário de login processando submissão");
                        
                        const usernameInput = document.getElementById('login-username');
                        const passwordInput = document.getElementById('login-password');
                        
                        if (!usernameInput || !passwordInput) {
                            console.error("Campos de login não encontrados");
                            alert("Erro: Campos de login não encontrados. Use o botão de login alternativo.");
                            return;
                        }
                        
                        const username = usernameInput.value;
                        const password = passwordInput.value;
                        
                        console.log("Tentativa de login com:", username);
                        
                        // Verificar credenciais simplificado
                        // Aceitando qualquer coisa para desbloquear o sistema em caso de problemas
                        login();
                    };
                    
                    // Adicionar múltiplos listeners para garantir que pelo menos um funcione
                    loginForm.addEventListener('submit', handleSubmit);
                    
                    // Também adicionar ao botão de submissão
                    const submitBtn = loginForm.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            handleSubmit();
                        });
                    }
                    
                    // Adicionar evento aos próprios campos
                    const usernameInput = document.getElementById('login-username');
                    const passwordInput = document.getElementById('login-password');
                    
                    if (usernameInput && passwordInput) {
                        passwordInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                handleSubmit();
                            }
                        });
                    }
                } else {
                    console.error("Formulário de login não encontrado!");
                }
                
                // Configurar botão de logout
                const logoutBtn = document.getElementById('btn-logout');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        logout();
                    });
                }
                
                // Configurar botões de navegação - Adicionando individualmente com event listeners completos
                document.getElementById('btn-dashboard')?.addEventListener('click', function() {
                    console.log("Clique no btn-dashboard");
                    showSection('dashboard-section');
                });
                
                document.getElementById('btn-employee-list')?.addEventListener('click', function() {
                    console.log("Clique no btn-employee-list");
                    showSection('employee-list-section');
                });
                
                document.getElementById('btn-allocation-history')?.addEventListener('click', function() {
                    console.log("Clique no btn-allocation-history");
                    showSection('allocation-history-section');
                });
                
                document.getElementById('btn-supervisor-management')?.addEventListener('click', function() {
                    console.log("Clique no btn-supervisor-management");
                    showSection('supervisor-management-section');
                });
                
                document.getElementById('btn-workstation-management')?.addEventListener('click', function() {
                    console.log("Clique no btn-workstation-management");
                    showSection('workstation-management-section');
                });
                
                document.getElementById('btn-import-export')?.addEventListener('click', function() {
                    console.log("Clique no btn-import-export");
                    showSection('import-export-section');
                });
                
                // Configurar eventos do modal de supervisor
                document.getElementById('btn-new-supervisor')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-supervisor");
                    showSupervisorModal();
                });
                
                document.getElementById('btn-new-supervisor-2')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-supervisor-2");
                    showSupervisorModal();
                });
                
                document.getElementById('supervisor-modal-close')?.addEventListener('click', hideSupervisorModal);
                document.getElementById('supervisor-cancel')?.addEventListener('click', hideSupervisorModal);
                document.getElementById('supervisor-form')?.addEventListener('submit', saveSupervisor);
                
                // Configurar eventos do modal de posto de trabalho
                document.getElementById('btn-new-workstation')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-workstation");
                    showWorkstationModal();
                });
                
                document.getElementById('workstation-modal-close')?.addEventListener('click', hideWorkstationModal);
                document.getElementById('workstation-cancel')?.addEventListener('click', hideWorkstationModal);
                document.getElementById('workstation-form')?.addEventListener('submit', saveWorkstation);
                
                // Configurar eventos do modal de funcionário
                document.getElementById('btn-new-employee')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-employee");
                    showEmployeeModal();
                });
                
                document.getElementById('btn-new-employee-2')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-employee-2");
                    showEmployeeModal();
                });
                
                document.getElementById('add-first-employee')?.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log("Clique no add-first-employee");
                    showEmployeeModal();
                });
                
                document.getElementById('employee-modal-close')?.addEventListener('click', hideEmployeeModal);
                document.getElementById('employee-cancel')?.addEventListener('click', hideEmployeeModal);
                document.getElementById('employee-form')?.addEventListener('submit', saveEmployee);
                
                // Configurar eventos de importação/exportação
                const importFileInput = document.getElementById('import-file');
                const fileNameDisplay = document.getElementById('file-name-display');
                const selectedFileInfo = document.getElementById('selected-file-info');
                
                if (importFileInput && fileNameDisplay) {
                    handleFileSelection(importFileInput, fileNameDisplay, selectedFileInfo);
                }
                
                const importBackupInput = document.getElementById('import-backup');
                const backupFileNameDisplay = document.getElementById('backup-file-name-display');
                const backupFileInfo = document.getElementById('backup-file-info');
                
                if (importBackupInput && backupFileNameDisplay) {
                    handleFileSelection(importBackupInput, backupFileNameDisplay, backupFileInfo);
                }
                
                // Botão de importação de dados
                document.getElementById('btn-import-data')?.addEventListener('click', function() {
                    const fileInput = document.getElementById('import-file');
                    const fileType = document.getElementById('import-file-type').value;
                    
                    if (fileInput && fileInput.files.length > 0) {
                        processCSVImport(fileInput.files[0], fileType);
                    } else {
                        showNotification('Por favor, selecione um arquivo CSV para importar.', 'warning');
                    }
                });
                
                // Botão de restauração de backup
                document.getElementById('btn-restore-backup')?.addEventListener('click', function() {
                    const backupInput = document.getElementById('import-backup');
                    
                    if (backupInput && backupInput.files.length > 0) {
                        processJSONBackup(backupInput.files[0]);
                    } else {
                        showNotification('Por favor, selecione um arquivo JSON para restaurar.', 'warning');
                    }
                });
                                             
                // Botões de exportação
                document.getElementById('btn-export-supervisors')?.addEventListener('click', function() {
                    exportData('supervisors');
                });
                
                document.getElementById('btn-export-workstations')?.addEventListener('click', function() {
                    exportData('workstations');
                });
                
                document.getElementById('btn-export-employees')?.addEventListener('click', function() {
                    exportData('employees');
                });
                
                document.getElementById('btn-export-allocations')?.addEventListener('click', function() {
                    exportData('allocations');
                });
                
                document.getElementById('btn-export-all')?.addEventListener('click', function() {
                    exportFullBackup();
                });
                
                // Configurar eventos de transferência
                document.getElementById('btn-transfer-employee')?.addEventListener('click', function() {
                    console.log("Clique no btn-transfer-employee");
                    showEmployeeSelectionModal();
                });
                
                document.getElementById('btn-transfer-employee-2')?.addEventListener('click', function() {
                    console.log("Clique no btn-transfer-employee-2");
                    showEmployeeSelectionModal();
                });
                
                document.getElementById('btn-new-transfer')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-transfer");
                    showEmployeeSelectionModal();
                });
                
                document.getElementById('add-first-allocation')?.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log("Clique no add-first-allocation");
                    showEmployeeSelectionModal();
                });
                
                document.getElementById('employee-selection-close')?.addEventListener('click', hideEmployeeSelectionModal);
                
                document.getElementById('transfer-modal-close')?.addEventListener('click', hideTransferModal);
                document.getElementById('transfer-cancel')?.addEventListener('click', hideTransferModal);
                document.getElementById('transfer-form')?.addEventListener('submit', saveTransfer);
                
                // Configurar eventos de filtro
                document.getElementById('employee-search')?.addEventListener('input', updateEmployeeList);
                document.getElementById('employee-status-filter')?.addEventListener('change', updateEmployeeList);
                document.getElementById('employee-workstation-filter')?.addEventListener('change', updateEmployeeList);
                
                document.getElementById('transfer-search')?.addEventListener('input', updateAllocationsList);
                document.getElementById('transfer-workstation')?.addEventListener('change', updateAllocationsList);
                document.getElementById('transfer-date-start')?.addEventListener('change', updateAllocationsList);
                document.getElementById('transfer-date-end')?.addEventListener('change', updateAllocationsList);
                
                document.getElementById('supervisor-search')?.addEventListener('input', updateSupervisorsGrid);
                document.getElementById('supervisor-workstation-filter')?.addEventListener('change', updateSupervisorsGrid);
                
                // Configurar eventos para a seção de postos de trabalho
                document.getElementById('btn-new-workstation-2')?.addEventListener('click', function() {
                    console.log("Clique no btn-new-workstation-2");
                    showWorkstationModal();
                });
                
                document.getElementById('btn-grid-view')?.addEventListener('click', function() {
                    toggleWorkstationView('grid');
                });
                
                document.getElementById('btn-list-view')?.addEventListener('click', function() {
                    toggleWorkstationView('list');
                });
                
                document.getElementById('workstation-search')?.addEventListener('input', updateWorkstationsList);
                document.getElementById('workstation-supervisor-filter')?.addEventListener('change', updateWorkstationsList);
                document.getElementById('workstation-capacity-filter')?.addEventListener('change', updateWorkstationsList);
                
                // Configurar eventos do relatório mensal
                document.getElementById('btn-generate-monthly-report')?.addEventListener('click', generateMonthlyReport);
                document.getElementById('btn-export-monthly-report')?.addEventListener('click', exportMonthlyReport);
                
                // Configurar dropdown de usuário
                const dropdown = document.querySelector('.dropdown');
                if (dropdown) {
                    dropdown.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const menu = this.querySelector('.dropdown-menu');
                        menu.classList.toggle('hidden');
                    });
                    
                    // Fechar dropdown ao clicar fora
                    document.addEventListener('click', function() {
                        const menu = dropdown.querySelector('.dropdown-menu');
                        if (menu && !menu.classList.contains('hidden')) {
                            menu.classList.add('hidden');
                        }
                    });
                }
                
                console.log("Inicialização completa. Sistema pronto.");
            } catch (error) {
                console.error('Erro na inicialização:', error);
                alert('Ocorreu um erro ao inicializar a aplicação: ' + error.message);
            }
        });
    </script>
</body>
</html>
